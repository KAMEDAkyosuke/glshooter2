/*
 bulletml.js v0.5.0-SNAPSHOT

 License
 http://daishihmr.mit-license.org/
*/
function d(b){throw b;}var h=void 0,i=!0,j=null,l=!1;function n(){return function(){}}var p={Fd:this};
(function(){function b(a,c){for(var b=0,f=a.length;b<f;b++)if(a[b].label==c)return a[b]}p.wa=function(a){this.type="none";this.root=this;this.na=[];this.Rb=[];this.Wb=[];if(a!==h){for(var c in a)a.hasOwnProperty(c)&&(a[c].label=c,a[c]instanceof p.xa?this.na.push(a[c]):a[c]instanceof p.Na?this.Rb.push(a[c]):a[c]instanceof p.kb&&this.Wb.push(a[c]));a=0;for(c=this.na.length;a<c;a++)this.na[a].Ba(this);a=0;for(c=this.Rb.length;a<c;a++)this.Rb[a].Ba(this);a=0;for(c=this.Wb.length;a<c;a++)this.Wb[a].Ba(this)}};
p.wa.prototype.jd=function(a){return b(this.na,a)};p.wa.prototype.je=function(){for(var a=[],c=0,b=this.na.length;c<b;c++){var f=this.na[c];f.label&&0===f.label.indexOf("top")&&(a[a.length]=f.label)}return a};p.wa.prototype.de=function(a){var c;if(c=this.jd(a))return c;d(Error("action labeled '"+a+"' is undefined."))};p.wa.prototype.ee=function(a){return b(this.Rb,a)};p.wa.prototype.fe=function(a){var c;if(c=this.ee(a))return c;d(Error("bullet labeled '"+a+"' is undefined."))};p.wa.prototype.ge=function(a){return b(this.Wb,
a)};p.wa.prototype.he=function(a){var c;if(c=this.ge(a))return c;d(Error("fire labeled '"+a+"' is undefined."))};p.Na=function(){this.root=this.label=j;this.direction=new p.Ja(0);this.speed=new p.La(1);this.na=[];this.ta={};this.da={}};p.Na.prototype.clone=function(a){var c=new p.Na;c.label=this.label;c.root=this.root;c.na=this.na;c.direction=new p.Ja(a.ra(this.direction.value));c.direction.type=this.direction.type;c.speed=new p.La(a.ra(this.speed.value));c.speed.type=this.speed.type;c.ta=this.ta;
c.da=a.da;return c};p.Na.prototype.Ba=function(a){this.root=a;for(var c=0,b=this.na.length;c<b;c++)this.na[c].Ba(a)};p.Eb=function(a){this.root=j;this.label=a;this.la=[]};p.Eb.prototype.clone=function(a){var c=a.da;a.da=a.oc(this.la);var b=this.root.fe(this.label).clone(a);a.da=c;return b};p.Eb.prototype.Ba=function(a){this.root=a};p.ma=function(){this.va=""};p.ma.prototype.Ba=function(a){this.root=a};p.xa=function(){this.va="action";this.root=this.label=j;this.Ca=[];this.la=[]};p.xa.prototype=new p.ma;
p.xa.prototype.Ba=function(a){this.root=a;for(var c=0,b=this.Ca.length;c<b;c++)this.Ca[c].Ba(a)};p.xa.prototype.clone=function(){var a=new p.xa;a.label=this.label;a.root=this.root;a.Ca=this.Ca;return a};p.jb=function(a){this.va="actionRef";this.label=a;this.root=j;this.la=[]};p.jb.prototype=new p.ma;p.jb.prototype.clone=function(){var a=new p.xa;a.root=this.root;a.Ca.push(this);return a};p.kb=function(){this.va="fire";this.ja=this.speed=this.direction=this.root=this.label=j;this.ta=new p.hc};p.kb.prototype=
new p.ma;p.kb.prototype.Ba=function(a){this.root=a;this.ja&&this.ja.Ba(a)};p.ic=function(a){this.va="fireRef";this.label=a;this.la=[]};p.ic.prototype=new p.ma;p.Fb=function(){this.va="changeDirection";this.direction=new p.Ja;this.ua=0};p.Fb.prototype=new p.ma;p.Gb=function(){this.va="changeSpeed";this.speed=new p.La;this.ua=0};p.Gb.prototype=new p.ma;p.Db=function(){this.va="accel";this.Ga=new p.jc;this.Ia=new p.mc;this.ua=0};p.Db.prototype=new p.ma;p.Ib=function(a){this.va="wait";this.value=a||0};
p.Ib.prototype=new p.ma;p.lc=function(){this.va="vanish"};p.lc.prototype=new p.ma;p.Hb=function(){this.va="repeat";this.Bd=0;this.action=j;this.la=[]};p.Hb.prototype=new p.ma;p.Hb.prototype.Ba=function(a){this.root=a;this.action&&this.action.Ba(a)};p.gc=function(a,c){this.va="bind";this.ue=a;this.ce=c};p.gc.prototype=new p.ma;p.kc=function(a,c){this.va="notify";this.$d=a;this.la=c||j};p.kc.prototype=new p.ma;p.Ed=new p.ma;p.Ja=function(a){this.type="aim";this.value=a||0};p.La=function(a){this.type=
"absolute";this.value=a===h?1:a};p.jc=function(a){this.type="absolute";this.value=a||0};p.mc=function(a){this.type="absolute";this.value=a||0};p.hc=function(a){a=a||{};this.offsetX=a.offsetX||0;this.offsetY=a.offsetY||0;this.mb=i;a.mb!==h&&(this.mb=!!a.mb)};p.Sc=function(a){this.value=a||0};p.Tc=function(a){this.value=a||0};p.Rc=function(a){this.value=!!a}})();p.Oa=function(b,a){this.Xc=b;this.Kb=[];this.Pa=-1;this.qa=j;this.da={};this.Jb={$rank:a||0}};
p.Oa.prototype.next=function(){this.Pa+=1;if(this.qa!==j){var b=this.qa.Ca[this.Pa];if(b!==h){if(b instanceof p.xa)return this.vb(),this.qa=b,this.da=this.nc(),this.next();if(b instanceof p.jb)return this.vb(),this.qa=this.Xc.de(b.label),this.da=this.oc(b.la),this.next();if(b instanceof p.Hb)return this.da.pb=0,this.da.sd=this.ra(b.Bd)|0,this.vb(),this.qa=b.action.clone(),this.da=this.nc(),this.next();if(b instanceof p.kb){var a=new p.kb;a.ja=b.ja.clone(this);b.direction!==j&&(a.direction=new p.Ja(this.ra(b.direction.value)),
a.direction.type=b.direction.type);b.speed!==j&&(a.speed=new p.La(this.ra(b.speed.value)),a.speed.type=b.speed.type);a.ta=b.ta;return a}return b instanceof p.ic?(this.vb(),this.qa=new p.xa,this.qa.Ca=[this.Xc.he(b.label)],this.da=this.oc(b.la),this.next()):b instanceof p.Fb?(a=new p.Fb,a.direction.type=b.direction.type,a.direction.value=this.ra(b.direction.value),a.ua=this.ra(b.ua),a):b instanceof p.Gb?(a=new p.Gb,a.speed.type=b.speed.type,a.speed.value=this.ra(b.speed.value),a.ua=this.ra(b.ua),a):
b instanceof p.Db?(a=new p.Db,a.Ga.type=b.Ga.type,a.Ga.value=this.ra(b.Ga.value),a.Ia.type=b.Ia.type,a.Ia.value=this.ra(b.Ia.value),a.ua=this.ra(b.ua),a):b instanceof p.Ib?new p.Ib(this.ra(b.value)):b instanceof p.lc?b:b instanceof p.gc?(this.da["$"+b.ue]=this.ra(b.ce),p.Ed):b instanceof p.kc?b:j}this.Sd();if(this.qa===j)return j;if((b=this.qa.Ca[this.Pa])&&"repeat"==b.va)this.da.pb++,this.da.pb<this.da.sd&&(this.vb(),this.qa=b.action.clone(),this.da=this.nc());return this.next()}return j};
p.Oa.prototype.vb=function(){this.Kb.push({action:this.qa,cursor:this.Pa,scope:this.da});this.Pa=-1};p.Oa.prototype.Sd=function(){var b=this.Kb.pop();b?(this.Pa=b.cursor,this.qa=b.action,this.da=b.scope):(this.Pa=-1,this.qa=j,this.da={})};
p.Oa.prototype.ra=function(b){var a;if("number"===typeof b)return b;if(isNaN(a=Number(b))){if((a=this.da[b])||(a=this.Jb[b]))return a;if("$rand"==b)return Math.random()}else return a;a={};for(var c in this.Jb)this.Jb.hasOwnProperty(c)&&(a[c]=this.Jb[c]);for(c in this.da)this.da.hasOwnProperty(c)&&(a[c]=this.da[c]);a.$rand=Math.random();(c=this.Kb[this.Kb.length-1])&&(a.$loop={index:c.scope.pb,count:c.scope.pb+1,first:0===c.scope.pb,last:c.scope.pb+1>=c.scope.sd});return(new Function("return "+b.split("$").join("this.$"))).apply(a)};
p.Oa.prototype.oc=function(b){var a={};if(b)for(var c=0,g=b.length;c<g;c++)a["$"+(c+1)]=this.ra(b[c]);else for(c in this.da)this.da.hasOwnProperty(c)&&(a[c]=this.da[c]);return a};p.Oa.prototype.nc=function(){var b={},a;for(a in this.da)this.da.hasOwnProperty(a)&&(b[a]=this.da[a]);return b};p.wa.prototype.Cc=function(b,a){var c=new p.Oa(this,a),g=this.jd(b);g&&(c.qa=g);return c};p.Na.prototype.Cc=function(b){b=new p.Oa(this.root,b);var a=new p.xa;a.root=this.root;a.Ca=this.na;b.qa=a;b.da=this.da;return b};p.fa=function(b){b=b||"";for(var a in p.fa)p.fa.hasOwnProperty(a)&&(p.Fd[b+a]=p.fa[a])};
p.fa.action=function(b){if(0<arguments.length)for(var a=0,c=arguments.length;a<c;a++)arguments[a]instanceof Function&&(arguments[a]=arguments[a]());if(b instanceof Array){a=0;for(c=b.length;a<c;a++)b[a]instanceof Function&&(b[a]=b[a]())}var g=new p.xa;if(b instanceof Array)b.some(function(a){return!(a instanceof p.ma)})&&d(Error("argument type error.")),g.Ca=b;else{a=0;for(c=arguments.length;a<c;a++)arguments[a]instanceof p.ma?g.Ca[a]=arguments[a]:d(Error("argument type error."))}return g};
p.fa.Be=function(b,a){for(var c=0,g=arguments.length;c<g;c++)arguments[c]instanceof Function&&(arguments[c]=arguments[c]());b===h&&d(Error("label is required."));g=new p.jb(b);if(a instanceof Array)g.la=a;else for(c=1;c<arguments.length;c++)g.la.push(arguments[c]);return g};
p.fa.ja=function(b,a,c,g){for(var f=0,k=arguments.length;f<k;f++)arguments[f]instanceof Function&&(arguments[f]=arguments[f]());k=new p.Na;for(f=0;f<arguments.length;f++)arguments[f]instanceof p.Ja?k.direction=arguments[f]:arguments[f]instanceof p.La?k.speed=arguments[f]:arguments[f]instanceof p.xa?k.na.push(arguments[f]):arguments[f]instanceof p.jb?k.na.push(arguments[f]):arguments[f]instanceof Array?k.na.push(p.fa.action(arguments[f])):arguments[f]instanceof Object?k.ta=arguments[f]:"string"===
typeof arguments[f]&&(k.label=arguments[f]);return k};p.fa.De=function(b,a){for(var c=0,g=arguments.length;c<g;c++)arguments[c]instanceof Function&&(arguments[c]=arguments[c]());b===h&&d(Error("label is required."));g=new p.Eb(b);if(a instanceof Array)g.la=a;else for(c=1;c<arguments.length;c++)g.la.push(arguments[c]);return g};
p.fa.Vb=function(b,a,c,g){for(var f=0,k=arguments.length;f<k;f++)arguments[f]instanceof Function&&(arguments[f]=arguments[f]());k=new p.kb;for(f=0;f<arguments.length;f++)arguments[f]instanceof p.Ja?k.direction=arguments[f]:arguments[f]instanceof p.La?k.speed=arguments[f]:arguments[f]instanceof p.Na?k.ja=arguments[f]:arguments[f]instanceof p.Eb?k.ja=arguments[f]:arguments[f]instanceof p.hc?k.ta=arguments[f]:arguments[f]instanceof p.Sc?k.ta.offsetX=arguments[f].value:arguments[f]instanceof p.Tc?k.ta.offsetY=
arguments[f].value:arguments[f]instanceof p.Rc&&(k.ta.mb=arguments[f].value);k.ja===h&&d(Error("bullet (or bulletRef) is required."));return k};p.fa.Je=function(b,a){for(var c=0,g=arguments.length;c<g;c++)arguments[c]instanceof Function&&(arguments[c]=arguments[c]());b===h&&d(Error("label is required."));g=new p.ic(b);if(a instanceof Array)g.la=a;else for(c=1;c<arguments.length;c++)g.la.push(arguments[c]);return g};
p.fa.Ee=function(b,a){for(var c=0,g=arguments.length;c<g;c++)arguments[c]instanceof Function&&(arguments[c]=arguments[c]());b===h&&d(Error("direction is required."));a===h&&d(Error("term is required."));c=new p.Fb;c.direction=b instanceof p.Ja?b:new p.Ja(b);c.ua=a;return c};
p.fa.Fe=function(b,a){for(var c=0,g=arguments.length;c<g;c++)arguments[c]instanceof Function&&(arguments[c]=arguments[c]());b===h&&d(Error("speed is required."));a===h&&d(Error("term is required."));c=new p.Gb;c.speed=b instanceof p.La?b:new p.La(b);c.ua=a;return c};
p.fa.Ae=function(b,a,c){for(var g=0,f=arguments.length;g<f;g++)arguments[g]instanceof Function&&(arguments[g]=arguments[g]());f=new p.Db;for(g=0;g<arguments.length;g++)arguments[g]instanceof p.jc?f.Ga=b:arguments[g]instanceof p.mc?f.Ia=a:f.ua=arguments[g];f.Ga===h&&f.Ia===h&&d(Error("horizontal or vertical is required."));f.ua===h&&d(Error("term is required."));return f};
p.fa.wait=function(b){for(var a=0,c=arguments.length;a<c;a++)arguments[a]instanceof Function&&(arguments[a]=arguments[a]());b===h&&d(Error("value is required."));return new p.Ib(b)};p.fa.Ue=function(){return new p.lc};
p.fa.repeat=function(b,a){for(var c=0,g=arguments.length;c<g;c++)arguments[c]instanceof Function&&(arguments[c]=arguments[c]());b===h&&d(Error("times is required."));a===h&&d(Error("action is required."));g=new p.Hb;g.Bd=b;if(a instanceof p.xa||a instanceof p.jb)g.action=a;else if(a instanceof Array)g.action=p.fa.action(a);else{for(var f=[],c=1;c<arguments.length;c++)f.push(arguments[c]);g.action=p.fa.action(f)}return g};p.fa.Ce=function(b,a){return new p.gc(b,a)};
p.fa.Re=function(b,a){return new p.kc(b,a)};p.fa.direction=function(b,a){for(var c=0,g=arguments.length;c<g;c++)arguments[c]instanceof Function&&(arguments[c]=arguments[c]());b===h&&d(Error("value is required."));c=new p.Ja(b);a!==h&&(c.type=a);return c};p.fa.speed=function(b,a){for(var c=0,g=arguments.length;c<g;c++)arguments[c]instanceof Function&&(arguments[c]=arguments[c]());b===h&&d(Error("value is required."));c=new p.La(b);a&&(c.type=a);return c};
p.fa.Ga=function(b,a){for(var c=0,g=arguments.length;c<g;c++)arguments[c]instanceof Function&&(arguments[c]=arguments[c]());b===h&&d(Error("value is required."));c=new p.jc(b);a&&(c.type=a);return c};p.fa.Ia=function(b,a){for(var c=0,g=arguments.length;c<g;c++)arguments[c]instanceof Function&&(arguments[c]=arguments[c]());b===h&&d(Error("value is required."));c=new p.mc(b);a&&(c.type=a);return c};p.fa.Ie=function(b){return new p.hc(b)};p.fa.offsetX=function(b){return new p.Sc(b)};p.fa.offsetY=function(b){return new p.Tc(b)};
p.fa.mb=function(b){return new p.Rc(b)};tm.sa=tm.sa||{};
(function(){function b(a){for(;a<=-Math.PI;)a+=2*Math.PI;for(;Math.PI<a;)a-=2*Math.PI;return a}function a(a,c){return Math.atan2(c.y-a.y,c.x-a.x)}tm.sa.Wa=tm.createClass({init:function(a){a||d(Error("argument is invalid.",a));this.Uc=a},Tb:function(a,c){var b=this.Uc.je();if(c===h&&0<b.length){for(var g=[],m=0,F=b.length;m<F;m++)g[g.length]=this.Vc(a,b[m]);for(var s=function(){for(var a=g.length;a--;)g[a].call(this);s.yc==g.length&&(s.xb=i,this.dispatchEvent(tm.event.Event("completeattack")))},m=
g.length;m--;)g[m].ec=s;s.yc=0;s.ad=function(){this.yc++};s.yc=0;s.xb=l;s.Fc=i;return s}return this.Vc(a,c)},Vc:function(a,c){function b(){b.ha+=1;this.ha=b.ha;var a=b.zc,c=b.Rd;if(c)if(b.ha<b.vc?b.direction+=b.ob:b.ha===b.vc&&(b.direction=b.Qa),b.ha<b.wc?b.speed+=b.Cb:b.ha===b.wc&&(b.speed=b.rb),b.ha<b.qc?(b.gb+=b.Nb,b.ib+=b.Ob):b.ha===b.qc&&(b.gb=b.Lb,b.ib=b.Mb),this.x+=Math.cos(b.direction)*b.speed*a.hb,this.y+=Math.sin(b.direction)*b.speed*a.hb,this.x+=b.gb*a.hb,this.y+=b.ib*a.hb,a.Gc(this)){if(a.sb||
this.sb)this.rotation=(b.direction+0.5*Math.PI)*Math.RAD_TO_DEG,this.speed=b.speed;if(!(b.ha<b.Cd||b.xb)){for(var f;f=b.Dd.next();)switch(f.va){case "fire":c.Od.call(this,f,a,b,c);break;case "wait":a=0;b.Cd="number"===typeof f.value?b.ha+f.value:0!==(a=~~f.value)?b.ha+a:b.ha+eval(f.value);return;case "changeDirection":c.Id.call(this,f,a,b);break;case "changeSpeed":c.Jd.call(this,f,b);break;case "accel":c.Gd.call(this,f,b);break;case "vanish":this.remove();break;case "notify":c.Pd.call(this,f)}b.xb=
i;b.ec?b.ec.ad():this.dispatchEvent(tm.event.Event("completeattack"))}}else this.remove(),b.xb=i,b.ec?b.ec.ad():this.dispatchEvent(tm.event.Event("completeattack"))}a=function(a){var b={},c=tm.sa.Wa.yb,f;for(f in c)c.hasOwnProperty(f)&&(b[f]=c[f]);for(f in a)a.hasOwnProperty(f)&&(b[f]=a[f]);return b}(a);a.target||d(Error("target is undefined in config."));c=c||"top";"string"===typeof c?b.Dd=this.Uc.Cc(c,a.yd):c instanceof p.Na?b.Dd=c.Cc(a.yd):(window.console.error(a,c),d(Error("\u5f15\u6570\u304c\u4e0d\u6b63")));
b.Rd=this;b.zc=a;b.Cd=-1;b.xb=l;b.direction=0;b.pd=0;b.speed=0;b.rd=0;b.gb=0;b.ib=0;b.ob=0;b.Qa=0;b.vc=-1;b.Cb=0;b.rb=0;b.wc=-1;b.Nb=0;b.Lb=0;b.Ob=0;b.Mb=0;b.qc=-1;b.ha=-1;b.Fc=i;return b},Nd:function(a){function b(){this.x+=b.cd;this.y+=b.dd;b.zc.Gc(this)||(this.remove(),this.dispatchEvent(tm.event.Event("removed")))}a=function(a){var b={},c=tm.sa.Wa.yb,f;for(f in c)c.hasOwnProperty(f)&&(b[f]=c[f]);for(f in a)a.hasOwnProperty(f)&&(b[f]=a[f]);return b}(a);a.target||d(Error("target is undefined in config."));
b.zc=a;b.direction=0;b.speed=0;b.cd=0;b.dd=0;b.Fc=i;return b},Od:function(b,c,g,t){var m={label:b.ja.label},F;for(F in b.ja.ta)m[F]=b.ja.ta[F];if(m=c.Zc(m)){var s=(F=!!b.ja.na.length)?t.Nd(c):t.Tb(c,b.ja),V=this,L={x:this.x+b.ta.offsetX,y:this.y+b.ta.offsetY};g.pd=s.direction=function(m){var t=eval(m.value)*Math.DEG_TO_RAD;switch(m.type){case "aim":return c.target?b.ta.mb?a(L,c.target)+t:a(V,c.target)+t:t-Math.PI/2;case "absolute":return t-Math.PI/2;case "relative":return g.direction+t;default:return g.pd+
t}}(b.direction||b.ja.direction);g.rd=s.speed=function(a){var b=eval(a.value);switch(a.type){case "relative":return g.speed+b;case "sequence":return g.rd+b;default:return b}}(b.speed||b.ja.speed);m.x=L.x;m.y=L.y;F&&(s.cd=Math.cos(s.direction)*s.speed*c.hb,s.dd=Math.sin(s.direction)*s.speed*c.hb);m.sb=!!m.sb;if(c.sb||m.sb)m.rotation=(s.direction+0.5*Math.PI)*Math.RAD_TO_DEG,m.speed=s.speed;m.addEventListener("enterframe",s);m.addEventListener("removed",function(){this.removeEventListener("enterframe",
s);this.removeEventListener("removed",arguments.callee)});c.ud.call(this,m)&&(c.Yc?c.Yc.addChild(m):this.parent&&this.parent.addChild(m))}},Id:function(c,g,r){var t=eval(c.direction.value)*Math.DEG_TO_RAD,m=eval(c.ua);switch(c.direction.type){case "aim":c=g.target;if(!c)return;r.Qa=a(this,c)+t;r.ob=b(r.Qa-r.direction)/m;break;case "absolute":r.Qa=t-Math.PI/2;r.ob=b(r.Qa-r.direction)/m;break;case "relative":r.Qa=r.direction+t;r.ob=b(r.Qa-r.direction)/m;break;case "sequence":r.ob=t,r.Qa=r.direction+
r.ob*(m-1)}r.vc=r.ha+m},Jd:function(a,b){var c=eval(a.speed.value),g=eval(a.ua);switch(a.speed.type){case "absolute":b.rb=c;b.Cb=(b.rb-b.speed)/g;break;case "relative":b.rb=c+b.speed;b.Cb=(b.rb-b.speed)/g;break;case "sequence":b.Cb=c,b.rb=b.speed+b.Cb*g}b.wc=b.ha+g},Gd:function(a,b){var c=eval(a.ua);b.qc=b.ha+c;if(a.Ga){var g=eval(a.Ga.value);switch(a.Ga.type){case "absolute":case "sequence":b.Nb=(g-b.gb)/c;b.Lb=g;break;case "relative":b.Nb=g,b.Lb=(g-b.gb)*c}}else b.Nb=0,b.Lb=b.gb;if(a.Ia)switch(g=
eval(a.Ia.value),a.Ia.type){case "absolute":case "sequence":b.Ob=(g-b.ib)/c;b.Mb=g;break;case "relative":b.Ob=g,b.Mb=(g-b.ib)*c}else b.Ob=0,b.Mb=b.ib},Pd:function(a){var b=tm.event.Event(a.$d);if(a.la)for(var c in a.la)b[c]=a.la[c];this.dispatchEvent(b)}});var c=function(){var a=tm.graphics.Canvas();a.resize(8,8);a.setTransformCenter();a.setLineStyle(0).setStrokeStyle("rgba(0,0,0,0)");a.setFillStyle(tm.graphics.RadialGradient(0,0,0,0,0,4).addColorStopList([{offset:0,color:"white"},{offset:0.5,color:"white"},
{offset:1,color:"red"}]).toStyle()).fillCircle(0,0,4);return a}();tm.sa.Wd=function(a){var b=tm.app.Sprite(8,8,c);b.label=a.label;return b};var g=j;tm.sa.Xd=function(a){g===j&&(g=a.getRoot());return 0<=a.x&&a.x<APP.width&&0<=a.y&&a.y<APP.height};tm.sa.Yd=function(){return i};tm.sa.Wa.yb={Zc:tm.sa.Wd,Gc:tm.sa.Xd,ud:tm.sa.Yd,yd:0,sb:l,hb:2,target:j};p.wa.prototype.Tb=function(a){return tm.sa.Wa(this).Tb(a)}})();/*
 gls2.js v1.0-beta

 License
 http://daishihmr.mit-license.org/
*/
tm.preload(function(){tm.util.ScriptManager.loadStats()});tm.main(function(){var b=q("#canvas2d");b.enableStats();b.run()});var u=j,v,w,z,A,B,C,D,E,G,H,I,J,K,M,q=tm.createClass({superClass:tm.app.CanvasApp,md:0,Ne:0,Pb:4,qb:4,ed:1,ga:j,init:function(b){this.superInit(b);u=this;this.resize(480,640).fitWindow();this.fps=60;this.background="black";this.keyboard=tm.input.Keyboard(window);this.replaceScene(tm.app.LoadingScene({assets:{tex0:"assets/tex0.png",tex1:"assets/tex1.png",laser:"assets/laser.png",laserHead:"assets/laser_head.png",laserFoot:"assets/laser_foot.png",explode0:"assets/explode0.png",explode1:"assets/explode1.png",
explode2:"assets/explode2.png",explode3:"assets/explode3.png",soundExplode:"assets/sen_ge_taihou03.mp3"},nextScene:function(){this.Qd();return v()}.bind(this)}))},Qd:function(){w.fb();N.fb();this.ga=z()},ae:function(){this.stop();tm.social.Nineleap.postRanking(this.md,"")}});function O(b){b.shadowColor="rgba(0,0,0,0.5)";b.shadowBlur=30;b.shadowOffsetX=20;b.shadowOffsetY=70}
tm.app.Label=tm.createClass({superClass:tm.app.Label,init:function(b,a){this.superInit(b,a);this.setAlign("center");this.setBaseline("middle");this.setFontFamily("Orbitron");this.fillStyle="white";this.isHitPoint=this.isHitPointRect},update:function(b){this.alpha=0.8+0.2*Math.sin(0.1*b.frame)}});function P(){if(0!==u.qb){var b=tm.asset.AssetManager.get("soundExplode");b.volume=0.1*u.qb;b&&b.clone().play()}}
tm.app.AnimationSprite.prototype.clone=function(){return tm.app.AnimationSprite(this.ss,this.width,this.height)};(function(){var b=j,a={"0":{x:1,y:0},45:{x:0.7,y:-0.7},90:{x:0,y:-1},135:{x:-0.7,y:-0.7},180:{x:-1,y:0},225:{x:-0.7,y:0.7},270:{x:0,y:1},315:{x:0.7,y:0.7}};A=tm.createClass({superClass:tm.app.Sprite,Ea:0,$a:i,td:l,ga:j,ke:100,speed:4.5,Ya:j,Ab:j,Zb:j,Qb:j,$b:j,ac:j,init:function(a){this.superInit("tex1",64,64);this.ga=a;tm.sa.Wa.yb.target=this;O(this);this.Ab=B(this,"laser","laserHead","laserFoot");this.Ab.visible=l;this.Ab.addChildTo(a);this.Md();this.Ya=[{x:-70,y:20,d:0.1,Va:l,Ra:-0.7,v:i},{x:-40,
y:40,d:0.1,Va:l,Ra:-0.5,v:i},{x:40,y:40,d:0.1,Va:i,Ra:0.5,v:i},{x:70,y:20,d:0.1,Va:i,Ra:0.7,v:i}];this.Qb=tm.app.CanvasElement().addChildTo(this);a=0;for(var b=this.Ya.length;a<b;a++){var f=this.Ya[a];C(this,f).setPosition(f.x,f.y).addChildTo(this.Qb)}this.$b=tm.app.CircleShape(80,80,{fillStyle:"rgba(0,0,0,0)",strokeStyle:tm.graphics.LinearGradient(0,0,0,80).addColorStopList([{offset:0,color:"rgba(100,100,255,0.0)"},{offset:0.3,color:"rgba(100,100,255,0.1)"},{offset:0.5,color:"rgba(255,255,255,1.0)"},
{offset:0.7,color:"rgba(100,100,255,0.1)"},{offset:1,color:"rgba(100,100,255,0.0)"}]).toStyle(),lineWidth:2}).addChildTo(this);this.$b.blendMode="lighter";this.$b.update=function(){this.rotation+=2};this.ac=tm.app.CircleShape(80,80,{fillStyle:"rgba(0,0,0,0)",strokeStyle:tm.graphics.LinearGradient(0,0,0,80).addColorStopList([{offset:0,color:"rgba(100,100,255,0.0)"},{offset:0.3,color:"rgba(100,100,255,0.1)"},{offset:0.5,color:"rgba(255,255,255,1.0)"},{offset:0.7,color:"rgba(100,100,255,0.1)"},{offset:1,
color:"rgba(100,100,255,0.0)"}]).toStyle(),lineWidth:2}).addChildTo(this);this.ac.blendMode="lighter";this.ac.update=function(){this.rotation-=2}},ze:function(){return[{x:-70,y:20,d:0.1,Va:l,Ra:-0.7,v:i},{x:-40,y:40,d:0.1,Va:l,Ra:-0.5,v:i},{x:40,y:40,d:0.1,Va:i,Ra:0.5,v:i},{x:70,y:20,d:0.1,Va:i,Ra:0.7,v:i}]},Md:function(){this.Zb=tm.app.Sprite("tex0",20,20).addChildTo(this);this.Zb.setFrameIndex(5);this.Zb.blendMode="lighter";this.Zb.update=function(a){a=0.75+0.15*Math.sin(0.2*a.frame);this.scale.set(a,
a)}},Ua:-1,Bc:l,zb:l,update:function(c){var g=c.keyboard;if(this.$a){var f=g.getKeyAngle();f!==j&&(f=a[f],this.x+=f.x*this.speed*(this.zb?0.75:1),this.y+=f.y*this.speed*(this.zb?0.75:1));this.x=Q(this.x,5,475);this.y=Q(this.y,5,635);var f=g.getKey("c"),k=g.getKey("z");this.Ua=f?this.Ua+1:this.Ua-1;this.Ua=Q(this.Ua,-1,10);this.zb=k&&f||10===this.Ua;this.Bc=!this.zb&&(0<=this.Ua||k)&&0===c.frame%3;k&&(this.Ua=0);if(this.zb){this.Ab.visible=i;f=0;for(k=this.Ya.length;f<k;f++)this.Ya[f].v=l;this.Qb.rotation=
0}else{this.Ab.visible=l;f=0;for(k=this.Ya.length;f<k;f++)this.Ya[f].v=i}this.Bc&&(c=Math.sin(0.2*c.frame),D(this.x-7-6*c,this.y-5,-90).addChildTo(this.ga),D(this.x-7+6*c,this.y-5,-90).addChildTo(this.ga),D(this.x+7-6*c,this.y-5,-90).addChildTo(this.ga),D(this.x+7+6*c,this.y-5,-90).addChildTo(this.ga))}this.$b.visible=this.ac.visible=100===this.ke;this.Vd(g);this.Hd(g);b===j&&(b=E(this.ga.Da));b.clone().setPosition(this.x-5,this.y+20).addChildTo(this.ga);b.clone().setPosition(this.x+5,this.y+20).addChildTo(this.ga)},
Vd:function(a){var b=this.Qb;b.rotation=this.$a&&a.getKey("left")?Math.max(b.rotation-2,-30):this.$a&&a.getKey("right")?Math.min(b.rotation+2,30):2<b.rotation?b.rotation-2:-2>b.rotation?b.rotation+2:0},Hd:function(a){this.$a&&a.getKey("left")?this.Ea=Q(this.Ea-0.2,-3,3):this.$a&&a.getKey("right")?this.Ea=Q(this.Ea+0.2,-3,3):0>this.Ea?this.Ea=Q(this.Ea+0.2,-3,3):0<this.Ea&&(this.Ea=Q(this.Ea-0.2,-3,3));a=3+~~this.Ea;this.setFrameIndex(a);return a}});C=tm.createClass({superClass:tm.app.AnimationSprite,
Xa:j,ca:j,init:function(a,b){this.superInit(tm.app.SpriteSheet({image:"tex1",frame:{width:32,height:32},animations:{anim0:{frames:[136,137,138,152,153,154],next:"anim0",frequency:3},anim1:{frames:[137,138,152,153,154,136].reverse(),next:"anim1",frequency:3}}}),32,32);this.Xa=b;this.ca=a;O(this);this.gotoAndPlay(b.Va?"anim0":"anim1")},update:function(a){if(this.Xa.v){this.x=this.Xa.x;this.y=this.Xa.y;this.rotation=Math.radToDeg(this.Xa.d*this.Xa.Ra);var g=this.parent.localToGlobal(this);this.Xa.v&&
b.clone().setPosition(g.x,g.y).addChildTo(a.ga);this.ca.Bc&&(D(g.x-3,g.y,this.parent.rotation+this.rotation-90).addChildTo(a.ga),D(g.x+3,g.y,this.parent.rotation+this.rotation-90).addChildTo(a.ga))}else this.x=0,this.y=-40,this.currentFrameIndex=3}})})();(function(){var b=j;D=tm.createClass({superClass:tm.app.CircleShape,speed:20,tc:1,init:function(c,g,f){this.superInit(24,24,{fillStyle:tm.graphics.RadialGradient(12,12,0,12,12,12).addColorStopList([{offset:0,color:"rgba(255,255,255,1)"},{offset:0.5,color:"rgba(255,255,255,1)"},{offset:1,color:"rgba(  0,100,255,0)"}]).toStyle(),strokeStyle:"rgba(0,0,0,0)"});this.blendMode="lighter";this.scaleY=0.5;var k=R(f);this.ve=Math.cos(k)*this.speed;this.we=Math.sin(k)*this.speed;this.setPosition(c,g);this.rotation=
f;this.addEventListener("added",function(){a.push(this)});this.addEventListener("removed",function(){var b=a.indexOf(this);-1!==b&&a.splice(b,1)});b===j&&(b=G(16,1,0.9,tm.graphics.Canvas().resize(16,16).setFillStyle(tm.graphics.RadialGradient(8,8,0,8,8,8).addColorStopList([{offset:0,color:"rgba(255,255,255,1.0)"},{offset:1,color:"rgba(255,128,  0,0.0)"}]).toStyle()).fillRect(0,0,16,16).element))},update:function(){this.x+=this.ve;this.y+=this.we;for(var a=[].concat(H.rc),b=0,f=a.length;b<f;b++){var k=
a[b];if((this.x-k.x)*(this.x-k.x)+(this.y-k.y)*(this.y-k.y)<(this.radius+k.radius)*this.radius+k.radius){this.Yb();k.bd(this.tc);this.remove();break}}(-60>this.x||540<this.x||-60>this.y||700<this.y)&&this.remove()},Yb:function(){var a=b.clone().setPosition(this.x,this.y).addChildTo(this.parent),g=S(2,8),f=2*Math.random()*Math.PI;a.za=Math.cos(f)*g;a.Aa=Math.sin(f)*g;a.scaleX=a.scaleY=(S(0.1,0.5)+S(0.1,0.5))/2;a.addEventListener("enterframe",function(){this.x+=this.za;this.y+=this.Aa;this.za*=0.9;
this.Aa*=0.9})}});D.wb=function(){for(var b=[].concat(a),g=0,f=b.length;g<f;g++)b[g].remove()};var a=D.rc=[]})();(function(){var b=j;B=tm.createClass({superClass:tm.app.CanvasElement,ca:j,image:j,c:j,ha:0,Fa:0,Se:j,tc:5,uc:l,head:j,ab:j,init:function(a,c,g,f){this.ca=a;a=tm.asset.AssetManager.get(c);this.superInit();this.image=a.element;this.width=a.width;this.height=640;this.blendMode="lighter";this.origin.y=1;this.c=tm.graphics.Canvas();this.c.resize(this.width,740);this.c.globalCompositeOperation="lighter";this.head=tm.app.AnimationSprite(tm.app.SpriteSheet({image:g,frame:{width:80,height:80},animations:{"default":{frames:[0,
1,2,3],next:"default"}}}),80,80);this.head.gotoAndPlay();this.head.blendMode="lighter";this.ab=tm.app.AnimationSprite(tm.app.SpriteSheet({image:f,frame:{width:128,height:64},animations:{"default":{frames:[0,1,2,3],next:"default"}}}),128,64);this.ab.gotoAndPlay();this.ab.blendMode="lighter";b===j&&(b=G(16,1,0.9,tm.graphics.Canvas().resize(16,16).setFillStyle(tm.graphics.RadialGradient(8,8,0,8,8,8).addColorStopList([{offset:0,color:"rgba(255,255,255,1.0)"},{offset:1,color:"rgba(  0,  0,255,0.0)"}]).toStyle()).fillRect(0,
0,16,16).element))},update:function(){this.x=this.ca.x;this.y=this.ca.y-40;if(this.visible){this.Fa=this.uc?this.Fa-50:this.y;var a=[].concat(H.rc);a.sort(function(a,b){return b.y-a.y});for(var b=0,g=a.length;b<g;b++){var f=a[b];this.Fa-30<f.y&&(f.y<this.y&&this.x-40<f.x&&f.x<this.x+40)&&(this.Fa=f.y,f.bd(this.tc),this.Yb(1))}this.head._updateFrame();this.ab._updateFrame()}else{if(this.uc)for(a=this.y;a>this.Fa;a-=30)this.Yb(1,a);this.Fa=this.y}-80>this.Fa&&(this.Fa=-80);this.uc=this.visible;this.ha+=
1},Yb:function(a,c){c=c||this.Fa;for(var g=0;g<a;g++){var f=b.clone().setPosition(this.x,c).addChildTo(this.parent),k=S(8,14),r=S(0,Math.PI);f.za=Math.cos(r)*k;f.Aa=Math.sin(r)*k;f.scaleX=f.scaleY=(S(0.5,1.5)+S(0.5,1.5))/2;f.addEventListener("enterframe",function(){this.x+=this.za;this.y+=this.Aa;this.za*=0.9;this.Aa*=0.9})}},draw:function(a){this.c.clear();for(var b=0;6>b;b++)this.c.drawImage(this.image,0,-(15*this.ha%240)+240*b);this.height=Math.max(this.y-this.Fa,1);a.context.drawImage(this.c.element,
0,this.c.height-this.height,this.c.width,this.height,-this.width*this.origin.x,-this.height*this.origin.y,this.width,this.height);var b=this.head.ss.getFrame(this.head.currentFrame),g=this.head.ss.image.element;a.drawImage(g,b.x,b.y,b.width,b.height,-this.width*this.origin.x-43,-this.height*this.origin.y-75,150,150);b=this.ab.ss.getFrame(this.ab.currentFrame);g=this.ab.ss.image.element;a.drawImage(g,b.x,b.y,b.width,b.height,-this.width*this.origin.x-43,-this.height*this.origin.y+this.height-37,150,
74)}})})();var T=tm.createClass({Te:0,Pe:0,He:0,ca:j,ga:j,frame:0,background:j,init:function(b){var a=this.ga=b;this.ca=b.ca;a.Da.direction=0.5*Math.PI;a.Da.speed=0.5;this.background=tm.graphics.LinearGradient(0,0,0,640).addColorStopList([{offset:0,color:"#030"},{offset:1,color:"#010"}]).toStyle()},update:function(){if(200<this.frame&&0===this.frame%30){var b;b=[];for(var a in I)I.hasOwnProperty(a)&&b.push(a);b=I[b.random()];a=0;for(var c=b.length;a<c;a++)this.me(b[a])}this.frame+=1},me:function(b){return H(this.ga,
b.aa,b.ba).setPosition(b.x,b.y).addChildTo(this.ga).eb()}});T.create=function(b){return T(b)};var N={fb:function(){N.explosion=Array.range(0,4).map(function(b){return tm.app.AnimationSprite(tm.app.SpriteSheet({image:"explode"+b,frame:{width:100,height:100},animations:{"default":{frame:Array.range(0,25),next:j}}},100,100))});N.shockwave=tm.app.CircleShape(100,100,{strokeStyle:"rgba(0,0,0,0)",fillStyle:tm.graphics.RadialGradient(50,50,0,50,50,50).addColorStopList([{offset:0,color:"rgba(255,255,255,0)"},{offset:0.7,color:"rgba(255,255,255,0)"},{offset:0.95,color:"rgba(255,255,255,1)"},{offset:1,
color:"rgba(255,255,255,0)"}]).toStyle()})},be:function(b,a,c){P();b=N.explosion[Math.rand(0,3)].clone().addEventListener("animationend",function(){this.remove()}).setPosition(b,a).setRotation(360*Math.random()).setBlendMode("lighter").gotoAndPlay();b.le=i;b.addChildTo(c)}};var X=tm.createClass({superClass:tm.app.Scene,pc:-1,init:function(){this.superInit()},finish:function(b){var a=this.app;a.popScene();(a=a.currentScene)&&-1!==a.pc&&a.Ic(a.pc,b)},Ad:function(b,a){this.pc=b;"function"===typeof a?this.app.pushScene(a()):a instanceof tm.app.Scene&&this.app.pushScene(a)},Ha:function(b,a,c,g,f,k){k===h&&(k=i);this.Ad(b,U(a,c,g,f,k))},Ic:n(),update:function(b){b.pointing.getPointingEnd()&&W(b.pointing).addChildTo(this)}}),W=tm.createClass({superClass:tm.app.CircleShape,
init:function(b){this.superInit(150,150,{strokeStyle:"rgba(0,0,0,0)",fillStyle:tm.graphics.RadialGradient(75,75,0,75,75,75).addColorStopList([{offset:0,color:"rgba(255,255,255,0.0)"},{offset:0.6,color:"rgba(255,255,255,0.0)"},{offset:1,color:"rgba(255,255,255,0.8)"}]).toStyle()});this.setPosition(b.x,b.y);this.width=this.height=1;this.tweener.clear().to({width:150,height:150,alpha:0},300,"easeOutQuad").call(function(){this.remove()}.bind(this))}});var U=tm.createClass({superClass:X,title:j,selection:[],selected:0,Ub:j,description:j,Za:j,wd:l,kd:l,cursor:j,zd:l,init:function(b,a,c,g,f){this.superInit();this.Ub=g?g:[].concat(a);f&&(a.push("exit"),this.Ub.push("\u524d\u306e\u753b\u9762\u3078\u623b\u308a\u307e\u3059"));this.zd=!!f;c!==h&&(this.selected=c);c=function(){var c=320-25*a.length;this.title=tm.app.Label(b,30).setPosition(240,c).addChildTo(this);this.selection=a.map(function(a,b){var f=this;c+=50;var g=tm.app.Label(a).setPosition(240,
c).addChildTo(this);g.interactive=i;g.addEventListener("touchend",function(){f.selected===b?f.xc(f.selected):f.selected=b});g.width=336;return g}.bind(this));this.Kd();this.wd=i}.bind(this);g=Math.max(50*(1+a.length),50)+40;this.Za=tm.app.RectangleShape(384,g,{strokeStyle:"rgba(0,0,0,0)",fillStyle:"rgba(1,2,48,0.8)"}).setPosition(240,320);this.Za.width=1;this.Za.height=1;this.Za.tweener.to({width:384,height:g},200,"easeOutExpo").call(c);this.Za.addChildTo(this);this.description=tm.app.Label("",14).setPosition(240,
630).addChildTo(this)},Kd:function(){this.cursor=tm.app.RectangleShape(336,10,{strokeStyle:"rgba(0,0,0,0)",fillStyle:tm.graphics.LinearGradient(0,0,336,0).addColorStopList([{offset:0,color:"rgba(  0,255,100,0.0)"},{offset:0.2,color:"rgba(  0,255,100,0.3)"},{offset:0.5,color:"rgba(  0,255,255,0.5)"},{offset:0.8,color:"rgba(  0,255,100,0.3)"},{offset:1,color:"rgba(  0,255,100,0.0)"}]).toStyle()}).addChildTo(this);this.cursor.blendMode="lighter";this.cursor.x=240;this.cursor.s=this.selected;this.cursor.y=
this.selection[this.selected].y;this.cursor.update=function(){this.s!==this.parent.selected&&(this.s=this.parent.selected,this.tweener.clear(),this.tweener.to({y:this.parent.selection[this.parent.selected].y},200,"easeOutExpo"))}},update:function(b){this.superClass.prototype.update.apply(this,arguments);this.Ub!==j&&(this.description.text=this.Ub[this.selected]);this.wd&&(this.kd?this.cursor.visible=0===~~(b.frame/2)%2:this.zd&&b.keyboard.getKeyDown("x")?(this.selected=this.selection.length-1,this.xc(this.selected)):
b.keyboard.getKeyDown("z")||b.keyboard.getKeyDown("space")?this.xc(this.selected):b.keyboard.getKeyDown("down")?(this.selected+=1,this.selected=Q(this.selected,0,this.selection.length-1)):b.keyboard.getKeyDown("up")&&(this.selected-=1,this.selected=Q(this.selected,0,this.selection.length-1)))},xc:function(b){this.kd=i;this.tweener.clear().wait(200).call(function(){this.cursor.remove();this.title.remove();this.selection.each(function(a){a.remove()});this.Za.tweener.clear();this.Za.tweener.to({width:1,
height:1},200,"easeInExpo").call(function(){this.finish(b)}.bind(this))}.bind(this))},draw:function(b){b.fillStyle="rgba(0,0,0,0.8)";b.fillRect(0,0,480,640)}});G=tm.createClass({superClass:tm.app.CanvasElement,alpha:1,sc:0.85,size:0,image:j,init:function(b,a,c,g){this.superInit();this.width=this.height=this.size=b;a!==h&&(this.alpha=a);c!==h&&(this.sc=c);this.blendMode="lighter";this.image=g?g:tm.graphics.Canvas().resize(b,b).setFillStyle(tm.graphics.RadialGradient(0.5*b,0.5*b,0,0.5*b,0.5*b,0.5*b).addColorStopList([{offset:0,color:"rgba(255,255,255,0.1)"},{offset:1,color:"rgba(  0,  0,  0,0.0)"}]).toStyle()).fillRect(0,0,b,b).element},update:function(){this.alpha*=
this.sc;0.0010>this.alpha?this.remove():1<this.alpha&&(this.alpha=1)},draw:function(b){b.context.drawImage(this.image,-this.width*this.origin.x,-this.height*this.origin.y,this.width,this.height)},clone:function(){return G(this.size,this.Oe,this.sc,this.image)}});
E=tm.createClass({superClass:G,Da:j,init:function(b){this.superInit(20,1,0.8,tm.graphics.Canvas().resize(20,20).setFillStyle(tm.graphics.RadialGradient(10,10,0,10,10,10).addColorStopList([{offset:0,color:"rgba(255,255,255,0.5)"},{offset:1,color:"rgba(  0,  0,  0,0.0)"}]).toStyle()).fillRect(0,0,20,20).element);this.Da=b},update:function(b){this.superClass.prototype.update.apply(this,b);this.x+=this.Da.za;this.y+=this.Da.Aa+0.2},clone:function(){return E(this.Da)}});var Y=tm.createClass({superClass:tm.app.RectangleShape,label:j,ya:j,init:function(b){this.superInit(b,64,{fillStyle:"rgba(1,2,48,0.5)",strokeStyle:"rgba(0,0,0,0)"});this.label=tm.app.Label("_",10).setAlign("left").setBaseline("top").setPosition(-this.width/2+4,-this.height/2+4).setFillStyle("rgba(255,255,255,0.5)").addChildTo(this);this.ya=[]},Td:function(b){5<this.ya.length&&this.ya.splice(1,this.ya.length-4);this.ya.push(b);return this},Ud:function(){this.ya.clear();return this},clear:function(){this.label.text=
"_";return this},update:function(b){var a=this.label.text,a=a.substring(0,a.length-1);if(0===b.frame%2&&0!==this.ya.length)if(""!==this.ya[0]){var c=this.ya[0][0];this.ya[0]=this.ya[0].substring(1);a+=c}else this.ya.shift(),c=a.split("\n"),3<c.length&&(c.shift(),a=c.join("\n")),a+="\n";this.label.text=a+(~~(b.frame/6)%2?"_":" ")}});(function(){var b=j,a=j;v=tm.createClass({superClass:X,result:j,ha:0,Bb:[],Xb:l,nd:j,qd:0,cc:0,init:function(){this.superInit();tm.app.Label("GL-Shooter 2",50).setPosition(240,160).addChildTo(this);tm.app.Label("version 1.0-beta",22).setPosition(432,192).setAlign("right").addChildTo(this);this.nd=tm.app.Label().setPosition(240,256).addChildTo(this);tm.app.Label("press space key").setPosition(240,576).addChildTo(this);this.addEventListener("enter",function(){this.Xb=l;this.nd.text="HIGH SCORE: "+u.md})},
draw:function(a){a.fillStyle="black";a.fillRect(0,0,480,640)},update:function(a){this.Wc(80*Math.cos(0.01*this.ha)+240,80*Math.sin(0.01*this.ha)+320,0);this.Wc(80*Math.cos(0.01*this.ha+Math.PI)+240,80*Math.sin(0.01*this.ha+Math.PI)+320,1);(a.keyboard.getKeyDown("space")||a.pointing.getPointingEnd())&&!this.Xb&&this.vd();this.ha+=1},Wc:function(c,g,f){if(!this.Xb){b===j&&(b=G(80,1,0.8,tm.graphics.Canvas().resize(80,80).setFillStyle(tm.graphics.RadialGradient(40,40,0,40,40,40).addColorStopList([{offset:0,
color:"rgba(255,255,255,0.1)"},{offset:1,color:"rgba(155,  0,  0,0.0)"}]).toStyle()).fillRect(0,0,80,80).element));a===j&&(a=G(80,1,0.8,tm.graphics.Canvas().resize(80,80).setFillStyle(tm.graphics.RadialGradient(40,40,0,40,40,40).addColorStopList([{offset:0,color:"rgba(255,255,255,0.1)"},{offset:1,color:"rgba(  0,  0,155,0.0)"}]).toStyle()).fillRect(0,0,80,80).element));f=0===f?b.clone().addChildTo(this):a.clone().addChildTo(this);f.speed=0.6;var k=S(0,2*Math.PI),r=Z(0,20);f.setPosition(Math.cos(k)*
r+c,Math.sin(k)*r+g);var t=this;f.update=function(){this.x+=Math.cos(k)*this.speed;this.y+=Math.sin(k)*this.speed;if(-50>this.x||530<this.x||-50>this.y||690<this.y){this.remove();var a=t.Bb.indexOf(this);-1!==a&&t.Bb.splice(a,1)}};this.Bb.push(f)}},Ic:function(a,b){var f={};f[0]=this.pe;f[1]=this.Lc;f[2]=this.Jc;f[3]=this.Kc;f[4]=this.oe;f[5]=n();(f=f[a])&&f.call(this,b)},vd:function(){this.Ha(0,"MAIN MENU",["start","tutorial","setting","save score"],this.qd,["\u30b2\u30fc\u30e0\u3092\u958b\u59cb\u3057\u307e\u3059",
"\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u3092\u958b\u59cb\u3057\u307e\u3059","\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u307e\u3059","\u30b2\u30fc\u30e0\u3092\u7d42\u4e86\u30579leap\u306b\u30b9\u30b3\u30a2\u3092\u767b\u9332\u3057\u307e\u3059"])},pe:function(a){4!==a&&(this.qd=a);switch(a){case 0:this.tweener.clear().call(function(){this.Xb=i;for(var a=0,b=this.Bb.length;a<b;a++)this.Bb[a].speed=6}.bind(this)).wait(1E3).call(function(){u.ga.ie(1);this.Ad(5,u.ga)}.bind(this));break;case 2:this.Ta();
break;case 3:u.ae()}},Ta:function(){this.Ha(1,"SETTING",["bgm volume","sound volume","difficulty"],this.cc,["BGM\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u8a2d\u5b9a\u3057\u307e\u3059","\u52b9\u679c\u97f3\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u8a2d\u5b9a\u3057\u307e\u3059","\u96e3\u6613\u5ea6\u3092\u8a2d\u5b9a\u3057\u307e\u3059"])},Lc:function(a){3!==a&&(this.cc=a);switch(a){case 0:this.Mc();break;case 1:this.Nc();break;case 2:this.se();break;default:this.vd()}},Mc:function(){this.Ha(2,"BGM VOLUME","012345".split(""),
u.Pb)},Jc:function(a){6!==a&&(u.Pb=a);this.Ta()},Nc:function(){this.Ha(3,"SE VOLUME","012345".split(""),u.qb)},Kc:function(a){6!==a&&(u.qb=a);this.Ta()},se:function(){this.Ha(4,"DIFFICULTY",["easy","normal","hard","very hard","hell"],u.ed,["\u521d\u5fc3\u8005\u3067\u3082\u5b89\u5fc3\u3057\u3066\u6311\u6226\u53ef\u80fd\u306a\u5165\u9580\u30b3\u30fc\u30b9","\u666e\u901a\u306e\u96e3\u6613\u5ea6\u3002easy\u3067\u306f\u7269\u8db3\u308a\u306a\u3044\u4eba\u3078","\u4e00\u822c\u7684\u306a\u5f3e\u5e55STG\u306e\u96e3\u6613\u5ea6",
"hard\u306f\u30cc\u30eb\u3059\u304e\u308b\u3068\u3044\u3046\u4eba\u5411\u3051","\u6b7b\u306c\u304c\u3088\u3044"])},oe:function(a){5!==a&&(u.ed=a);this.Ta()},toString:function(){return"gls2.TitleScene"}})})();tm.createClass({superClass:X,init:function(){this.superInit();tm.app.Label("This is ShipSelectScene").setAlign("center").setBaseline("middle").setPosition(240,320).addChildTo(this)}});(function(){var b=j;z=tm.createClass({superClass:X,ca:j,score:0,fc:j,Da:j,Qc:3,ld:j,xd:j,hd:j,fd:j,gd:j,$c:j,od:j,Ac:j,init:function(){b!==j&&d(Error("class 'gls2.GameScene' is singleton!!"));this.superInit();b=this;this.Ld();this.ld=tm.app.Object2D().addChildTo(this);this.hd=tm.app.Object2D().addChildTo(this);this.fd=tm.app.Object2D().addChildTo(this);this.xd=tm.app.Object2D().addChildTo(this);this.gd=tm.app.Object2D().addChildTo(this);this.$c=tm.app.Object2D().addChildTo(this);this.od=tm.app.Object2D().addChildTo(this);
this.Ac=Y(200).setPosition(375,37).addChildTo(this.od);tm.sa.Wa.yb.Yc=this},Oc:function(a){this.Ac.Td(a)},Ld:function(){var a=this.Da=tm.app.CanvasElement().addChildTo(this);a.Dc=a.Ec=0;a.direction=0.5*Math.PI;a.Sb=20;a.speed=1;a.za=0;a.Aa=0;a.update=function(){this.za=Math.cos(this.direction)*this.speed;this.Aa=Math.sin(this.direction)*this.speed;this.Dc=(this.Dc+this.za)%this.Sb;this.Ec=(this.Ec+this.Aa)%this.Sb};a.blendMode="lighter";a.draw=function(a){a.lineWidth=0.2;a.strokeStyle="#rgba(255,255,255,0.5)";
a.beginPath();for(var b=this.Dc;480>b;b+=this.Sb)a.line(b,0,b,640);for(b=this.Ec;640>b;b+=this.Sb)a.line(0,b,480,b);a.stroke()}},addChild:function(a){a instanceof A?this.xd.addChild(a):a instanceof H?a.aa.bc?this.ld.addChild(a):this.hd.addChild(a):a instanceof E||a instanceof D||a instanceof B?this.fd.addChild(a):a instanceof G||a.le?this.gd.addChild(a):a instanceof J?this.$c.addChild(a):this.superClass.prototype.addChild.apply(this,arguments)},update:function(a){this.fc.update(a.frame);a.keyboard.getKeyDown("escape")?
this.finish(0):a.keyboard.getKeyDown("space")?this.dc(0):a.keyboard.getKeyDown("p")&&(a.canvas.saveAsImage(),this.dc(0))},Ic:function(a,b){switch(a){case 0:this.qe(b);break;case 1:this.Lc(b);break;case 2:this.ne(b);break;case 3:this.Jc(b);break;case 4:this.Kc(b)}},dc:function(a){this.Ha(0,"PAUSE",["resume","setting","exit game"],a,["\u30b2\u30fc\u30e0\u3092\u518d\u958b\u3057\u307e\u3059","\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u307e\u3059","\u30b2\u30fc\u30e0\u3092\u4e2d\u65ad\u3057\u3001\u30bf\u30a4\u30c8\u30eb\u753b\u9762\u306b\u623b\u308a\u307e\u3059"],
l)},qe:function(a){switch(a){case 1:this.Ta();break;case 2:this.re()}},Ta:function(){this.Ha(1,"SETTING",["bgm volume","sound volume"],this.cc,["BGM\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u8a2d\u5b9a\u3057\u307e\u3059","\u52b9\u679c\u97f3\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u8a2d\u5b9a\u3057\u307e\u3059"])},Lc:function(a){3!==a&&(this.cc=a);switch(a){case 0:this.Mc();break;case 1:this.Nc();break;default:this.dc()}},re:function(){this.Ha(2,"REARY?",["yes","no"],1,["\u30b2\u30fc\u30e0\u3092\u4e2d\u65ad\u3057\u3001\u30bf\u30a4\u30c8\u30eb\u753b\u9762\u306b\u623b\u308a\u307e\u3059",
"\u524d\u306e\u753b\u9762\u3078\u623b\u308a\u307e\u3059"],l)},ne:function(a){0===a?this.finish(0):this.dc(1)},Mc:function(){this.Ha(3,"BGM VOLUME","012345".split(""),u.Pb)},Jc:function(a){6!==a&&(u.Pb=a);this.Ta(1)},Nc:function(){this.Ha(4,"SE VOLUME","012345".split(""),u.qb)},Kc:function(a){6!==a&&(u.qb=a);this.Ta(1)},draw:function(a){this.fc!==j&&a.clearColor(this.fc.background,0,0)},ie:function(){this.Ac.Ud().clear();this.ca!==j&&this.ca.remove();H.wb();D.wb();w.wb();this.ca=A(this);this.te(0)},
te:function(a){this.fc=T.create(this,a);this.Hc()},Hc:function(){this.ca.setPosition(240,672).setFrameIndex(3).addChildTo(this);this.ca.$a=l;this.ca.td=i;this.ca.tweener.clear().wait(30).moveBy(0,-120).wait(120).call(function(){this.$a=i}.bind(this.ca)).wait(120).call(function(){this.td=l}.bind(this.ca))},Qe:function(){this.ca.remove();this.Qc-=1;0<this.Qc&&this.Hc()},Le:function(){this.Hc()},Ge:n(),Me:n(),Ke:n()})})();tm.createClass({superClass:X,init:function(){this.superInit()},update:function(b){this.superClass.prototype.update.apply(this,arguments)}});tm.createClass({superClass:X,init:function(){this.superInit()},update:function(b){this.superClass.prototype.update.apply(this,arguments)}});tm.createClass({superClass:X,init:function(){this.superInit()},update:function(b){this.superClass.prototype.update.apply(this,arguments)}});tm.createClass({superClass:X,init:function(){this.superInit()},update:function(b){this.superClass.prototype.update.apply(this,arguments)}});(function(){H=tm.createClass({superClass:tm.app.CanvasElement,frame:0,direction:0,speed:0,ca:j,ga:j,aa:j,ba:j,Ma:0,init:function(a,c,g){this.superInit();this.frame=0;this.ga=a;this.ca=this.ga.ca;this.aa=c(this);this.ba=g(this);this.ba.fb(this);this.aa.fb(this);this.aa.bc||O(this);this.addEventListener("completeattack",function(){this.cb()});this.addEventListener("added",function(){b.push(this)});this.addEventListener("removed",function(){var a=b.indexOf(this);-1!==a&&b.splice(a,1)})},eb:function(){this.ba.eb();
this.aa.eb()},cb:function(){this.ba.cb();this.aa.cb()},update:function(a){this.ba.update();this.aa.update();this.aa.bc&&(this.x+=a.ga.Da.za,this.y+=a.ga.Da.Aa);this.frame+=1},bd:function(a){if(this.x<this.radius||480-this.radius<this.x||this.y<this.radius||640-this.radius<this.y)return l;this.Ma-=a;return 0>=this.Ma?(this.aa.Zd(),a=Z(0,2),0===a?this.ga.Oc("enemy destroy."):1===a?this.ga.Oc(this.aa.name+" destroy."):2===a&&this.ga.Oc("ETR reaction gone."),this.remove(),i):l},draw:function(a){this.aa.draw(a)}});
H.wb=function(){for(var a=[].concat(b),c=0,g=a.length;c<g;c++)a[c].remove()};var b=H.rc=[]})();(function(){K=tm.createClass({$:j,bc:l,ka:j,Ma:10,name:"enemy",init:function(a){this.$=a},fb:function(){this.$.Ma=this.Ma},eb:n(),cb:n(),update:n(),draw:n(),Zd:function(){N.be(this.$.x,this.$.y,this.$.ga)}});K.oa=tm.createClass({superClass:K,name:"kujo",Ma:3,init:function(a){this.superInit(a);this.ka=b("tex1",64,64)},update:function(){this.$.scaleX=this.$.x<this.$.ca.x?-1:1},draw:function(a){2>this.$.frame%4?this.ka.setFrameIndex(7):this.ka.setFrameIndex(8);this.ka.draw(a)}});K.ea=tm.createClass({superClass:K,
name:"kiryu",Ma:10,init:function(a){this.superInit(a);this.ka=b("tex1",64,64)},update:function(){this.$.scaleX=this.$.x<this.$.ca.x?-1:1},draw:function(a){2>this.$.frame%4?this.ka.setFrameIndex(9):this.ka.setFrameIndex(10);this.ka.draw(a)}});K.ia=tm.createClass({superClass:K,name:"natsuki",Ma:5,init:function(a){this.superInit(a);this.bc=i;this.ka=b("tex1",48,48);this.$.radius=24},update:function(){switch(this.$.direction){case 0:this.ka.setFrameIndex(16,64,64);break;case 1:this.ka.setFrameIndex(24,
64,64);break;case 2:this.ka.setFrameIndex(23,64,64);break;case 3:this.ka.setFrameIndex(11,64,64);break;case 4:this.ka.setFrameIndex(12,64,64);break;case 5:this.ka.setFrameIndex(13,64,64);break;case 6:this.ka.setFrameIndex(14,64,64);break;case 7:this.ka.setFrameIndex(15,64,64)}},draw:function(a){this.ka.draw(a)}});var b=tm.createClass({superClass:tm.app.Sprite,init:function(a,b,g){this.superInit(a,b,g)},draw:function(a){var b=this.srcRect;a.context.drawImage(this._image.element,b.x,b.y,b.width,b.height,
-this.width*this.origin.x,-this.height*this.origin.y,this.width,this.height)}})})();(function(){function b(a,b){var g=w[b].Tb();a.addEventListener("enterframe",g);a.addEventListener("completeattack",function(){this.removeEventListener("enterframe",g)})}M=tm.createClass({$:j,ca:j,Sa:l,init:function(a){this.$=a;this.ca=a.ga.ca;this.Sa=l},fb:n(),eb:n(),cb:n(),update:n(),nb:function(){this.bb()&&(this.Sa=i)},bb:function(){var a=this.$.radius;return-a<=this.$.x&&this.$.x<480+a&&-a<=this.$.y&&this.$.y<640+a}});M.Ka=tm.createClass({superClass:M,init:function(a){this.superInit(a)},eb:function(){var a=
S(64,192);this.$.tweener.clear().wait(Z(10,500)).move(this.$.x,a,7*a,"easeOutQuad").call(function(){b(this.$,"basic0-0")}.bind(this))},cb:function(){this.$.tweener.clear().wait(1E3).moveBy(0,-640,2E3,"easeInQuad").call(function(){this.$.remove()}.bind(this))}});M.lb=tm.createClass({superClass:M,init:function(a){this.superInit(a)},eb:function(){var a=S(192,320);this.$.tweener.clear().wait(Z(10,500)).move(this.$.x,a,7*a,"easeOutQuad").call(function(){b(this.$,"basic0-0")}.bind(this))},cb:function(){this.$.tweener.clear().wait(1E3).moveBy(0,
-640,2E3,"easeInQuad").call(function(){this.$.remove()}.bind(this))}});M.ea=tm.createClass({superClass:M,init:function(a){this.superInit(a);this.angle=0.5*Math.PI;this.Pc=Z(0,60);this.speed=0},update:function(){this.nb();var a=this.$.frame;a===this.Pc?this.speed=8:a===this.Pc+10?b(this.$,"basic1-0"):this.Pc<a&&this.$.y<this.ca.y&&(this.angle+=Math.atan2(this.ca.y-this.$.y,this.ca.x-this.$.x)<this.angle?-0.02:0.02,this.angle=Q(this.angle,0.5,Math.PI-0.5));this.$.x+=Math.cos(this.angle)*this.speed;
this.$.y+=Math.sin(this.angle)*this.speed;!this.bb()&&this.Sa&&this.$.remove();if(9E4>(this.$.x-this.ca.x)*(this.$.x-this.ca.x)+(this.$.y-this.ca.y)*(this.$.y-this.ca.y)){var a=this.$,c=[].concat(a._listeners.enterframe);if(c)for(var g=0,f=c.length;g<f;g++)c[g]&&c[g].Fc&&a.removeEventListener("enterframe",c[g])}}});M.tb=tm.createClass({superClass:M,init:function(a){this.superInit(a);b(this.$,"basic2-0");this.$.direction=0},update:function(){this.nb();this.$.x+=1;this.Sa&&!this.bb()&&this.$.remove()}});
M.ub=tm.createClass({superClass:M,init:function(a){this.superInit(a);b(this.$,"basic2-0");this.$.direction=1},update:function(){this.nb();this.$.x+=0.7;this.$.y+=0.7;this.Sa&&!this.bb()&&this.$.remove()}});M.pa=tm.createClass({superClass:M,init:function(a){this.superInit(a);b(this.$,"basic2-0");this.$.direction=2},update:function(){this.nb();this.$.y+=1;this.Sa&&!this.bb()&&this.$.remove()}});M.ye=tm.createClass({superClass:M,init:function(a){this.superInit(a);b(this.$,"basic2-0");this.$.direction=
3},update:function(){this.nb();this.$.x-=0.7;this.$.y+=0.7;this.Sa&&!this.bb()&&this.$.remove()}});M.xe=tm.createClass({superClass:M,init:function(a){this.superInit(a);b(this.$,"basic2-0");this.$.direction=4},update:function(){this.nb();this.$.x-=1;this.Sa&&!this.bb()&&this.$.remove()}})})();I={"heri1-left":[{aa:K.ea,ba:M.Ka,x:48,y:-100},{aa:K.ea,ba:M.lb,x:96,y:-100},{aa:K.ea,ba:M.Ka,x:144,y:-100},{aa:K.ea,ba:M.lb,x:192,y:-100},{aa:K.ea,ba:M.Ka,x:240,y:-100}],"heri1-center":[{aa:K.ea,ba:M.Ka,x:144,y:-100},{aa:K.ea,ba:M.lb,x:192,y:-100},{aa:K.ea,ba:M.Ka,x:240,y:-100},{aa:K.ea,ba:M.lb,x:288,y:-100},{aa:K.ea,ba:M.Ka,x:336,y:-100}],"heri1-right":[{aa:K.ea,ba:M.Ka,x:240,y:-100},{aa:K.ea,ba:M.lb,x:288,y:-100},{aa:K.ea,ba:M.Ka,x:336,y:-100},{aa:K.ea,ba:M.lb,x:384,y:-100},{aa:K.ea,ba:M.Ka,x:432,
y:-100}],"heri2-left":[{aa:K.oa,ba:M.ea,x:48,y:-100},{aa:K.oa,ba:M.ea,x:96,y:-100},{aa:K.oa,ba:M.ea,x:144,y:-100},{aa:K.oa,ba:M.ea,x:192,y:-100},{aa:K.oa,ba:M.ea,x:240,y:-100}],"heri2-center":[{aa:K.oa,ba:M.ea,x:144,y:-100},{aa:K.oa,ba:M.ea,x:192,y:-100},{aa:K.oa,ba:M.ea,x:240,y:-100},{aa:K.oa,ba:M.ea,x:288,y:-100},{aa:K.oa,ba:M.ea,x:336,y:-100}],"heri2-right":[{aa:K.oa,ba:M.ea,x:240,y:-100},{aa:K.oa,ba:M.ea,x:288,y:-100},{aa:K.oa,ba:M.ea,x:336,y:-100},{aa:K.oa,ba:M.ea,x:384,y:-100},{aa:K.oa,ba:M.ea,
x:432,y:-100}],"tank-left":[{aa:K.ia,ba:M.tb,x:-64,y:192},{aa:K.ia,ba:M.tb,x:-128,y:192},{aa:K.ia,ba:M.tb,x:-192,y:192},{aa:K.ia,ba:M.tb,x:-256,y:192},{aa:K.ia,ba:M.tb,x:-320,y:192}],"tank-leftUpper":[{aa:K.ia,ba:M.ub,x:-110,y:-46},{aa:K.ia,ba:M.ub,x:-156,y:-92},{aa:K.ia,ba:M.ub,x:-202,y:-138},{aa:K.ia,ba:M.ub,x:-248,y:-184},{aa:K.ia,ba:M.ub,x:-294,y:-230}],"tank-upper0":[{aa:K.ia,ba:M.pa,x:120,y:-64},{aa:K.ia,ba:M.pa,x:120,y:-128},{aa:K.ia,ba:M.pa,x:120,y:-192},{aa:K.ia,ba:M.pa,x:120,y:-256},{aa:K.ia,
ba:M.pa,x:120,y:-320}],"tank-upper1":[{aa:K.ia,ba:M.pa,x:240,y:-64},{aa:K.ia,ba:M.pa,x:240,y:-128},{aa:K.ia,ba:M.pa,x:240,y:-192},{aa:K.ia,ba:M.pa,x:240,y:-256},{aa:K.ia,ba:M.pa,x:240,y:-320}],"tank-upper2":[{aa:K.ia,ba:M.pa,x:360,y:-64},{aa:K.ia,ba:M.pa,x:360,y:-128},{aa:K.ia,ba:M.pa,x:360,y:-192},{aa:K.ia,ba:M.pa,x:360,y:-256},{aa:K.ia,ba:M.pa,x:360,y:-320}]};(function(){var b=[],a=[];J=tm.createClass({superClass:tm.app.Sprite,init:function(){this.superInit("tex0",20,20)}});w={fb:function(){for(var c=0;255>c;c++){var g=J();g.addEventListener("removed",function(){this.clearEventListener("enterframe");b.push(this);var c=a.indexOf(this);-1!==c&&a.splice(c,1)});b.push(g)}c=tm.sa.Wa.yb;c.Gc=function(a){return!(a instanceof J)||!(-50>a.x||530<a.x||-50>a.y||690<a.y)};c.Zc=function(){var c=b.shift(0);if(c)return a.push(c),c.setFrameIndex(1),c.scaleX=1.2,c.scaleY=
1.5,c.addEventListener("enterframe",function(){this.rotation+=15}),c;console.warn("\u5f3e\u304c\u8db3\u308a\u306a\u3044\uff01")};c.hb=4;c.ud=function(){return i}},wb:function(){for(var b=[].concat(a),c=0,g=b.length;c<g;c++)b[c].remove()}};var c=p.fa,g=c.Vb(c.direction(0),c.ja());w["basic0-0"]=new p.wa({top:c.action([g])});w["basic0-4"]=new p.wa({top:c.action([c.repeat(3,[c.repeat(5,[c.Vb(c.direction(-20),c.speed("$loop.count*0.06+0.75"),c.ja()),c.Vb(c.direction(0),c.speed("$loop.count*0.06+0.75"),
c.ja()),c.Vb(c.direction(20),c.speed("$loop.count*0.06+0.75"),c.ja())]),c.wait(40)])])});w["basic1-0"]=new p.wa({top:c.action([c.repeat(999,[g,c.wait(20)])])});w["basic2-0"]=new p.wa({top:c.action([c.wait("120"),c.repeat(999,[c.wait("50*$rand*5"),g])])})})();var Q,R,S,Z,$;Q=function(b,a,c){return b<a?a:b>c?c:b};$=Math.PI/180;R=function(b){return b*$};Z=function(b,a){return window.Math.floor(Math.random()*(a-b+1))+b};S=function(b,a){return window.Math.random()*(a-b)+b};

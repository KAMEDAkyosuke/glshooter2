/*
 bulletml.js v0.5.0-SNAPSHOT

 License
 http://daishihmr.mit-license.org/
*/
function d(b){throw b;}var h=void 0,m=!0,n=null,p=!1;function q(){return function(){}}var u={td:this,_temp:q()};
(function(){function b(a,c){for(var b=0,g=a.length;b<g;b++)if(a[b].label==c)return a[b]}u.sa=function(a){this.type="none";this.root=this;this.ka=[];this.Fb=[];this.Lb=[];if(a!==h){for(var c in a)a.hasOwnProperty(c)&&(a[c].label=c,a[c]instanceof u.ra?this.ka.push(a[c]):a[c]instanceof u.Ha?this.Fb.push(a[c]):a[c]instanceof u.$a&&this.Lb.push(a[c]));a=0;for(c=this.ka.length;a<c;a++)this.ka[a].wa(this);a=0;for(c=this.Fb.length;a<c;a++)this.Fb[a].wa(this);a=0;for(c=this.Lb.length;a<c;a++)this.Lb[a].wa(this)}};
u.sa.prototype.Yc=function(a){return b(this.ka,a)};u.sa.prototype.Yd=function(){for(var a=[],c=0,b=this.ka.length;c<b;c++){var g=this.ka[c];g.label&&0===g.label.indexOf("top")&&(a[a.length]=g.label)}return a};u.sa.prototype.Sd=function(a){var c;if(c=this.Yc(a))return c;d(Error("action labeled '"+a+"' is undefined."))};u.sa.prototype.Td=function(a){return b(this.Fb,a)};u.sa.prototype.Ud=function(a){var c;if(c=this.Td(a))return c;d(Error("bullet labeled '"+a+"' is undefined."))};u.sa.prototype.Vd=function(a){return b(this.Lb,
a)};u.sa.prototype.Wd=function(a){var c;if(c=this.Vd(a))return c;d(Error("fire labeled '"+a+"' is undefined."))};u.Ha=function(){this.root=this.label=n;this.direction=new u.Fa(0);this.speed=new u.Ga(1);this.ka=[];this.oa={};this.da={}};u.Ha.prototype.clone=function(a){var c=new u.Ha;c.label=this.label;c.root=this.root;c.ka=this.ka;c.direction=new u.Fa(a.ma(this.direction.value));c.direction.type=this.direction.type;c.speed=new u.Ga(a.ma(this.speed.value));c.speed.type=this.speed.type;c.oa=this.oa;
c.da=a.da;return c};u.Ha.prototype.wa=function(a){this.root=a;for(var c=0,b=this.ka.length;c<b;c++)this.ka[c].wa(a)};u.sb=function(a){this.root=n;this.label=a;this.ia=[]};u.sb.prototype.clone=function(a){var c=a.da;a.da=a.cc(this.ia);var b=this.root.Ud(this.label).clone(a);a.da=c;return b};u.sb.prototype.wa=function(a){this.root=a};u.ja=function(){this.qa=""};u.ja.prototype.wa=function(a){this.root=a};u.ra=function(){this.qa="action";this.root=this.label=n;this.xa=[];this.ia=[]};u.ra.prototype=new u.ja;
u.ra.prototype.wa=function(a){this.root=a;for(var c=0,b=this.xa.length;c<b;c++)this.xa[c].wa(a)};u.ra.prototype.clone=function(){var a=new u.ra;a.label=this.label;a.root=this.root;a.xa=this.xa;return a};u.Za=function(a){this.qa="actionRef";this.label=a;this.root=n;this.ia=[]};u.Za.prototype=new u.ja;u.Za.prototype.clone=function(){var a=new u.ra;a.root=this.root;a.xa.push(this);return a};u.$a=function(){this.qa="fire";this.ha=this.speed=this.direction=this.root=this.label=n;this.oa=new u.Wb};u.$a.prototype=
new u.ja;u.$a.prototype.wa=function(a){this.root=a;this.ha&&this.ha.wa(a)};u.Xb=function(a){this.qa="fireRef";this.label=a;this.ia=[]};u.Xb.prototype=new u.ja;u.tb=function(){this.qa="changeDirection";this.direction=new u.Fa;this.pa=0};u.tb.prototype=new u.ja;u.ub=function(){this.qa="changeSpeed";this.speed=new u.Ga;this.pa=0};u.ub.prototype=new u.ja;u.rb=function(){this.qa="accel";this.Ca=new u.Yb;this.Ea=new u.ac;this.pa=0};u.rb.prototype=new u.ja;u.wb=function(a){this.qa="wait";this.value=a||0};
u.wb.prototype=new u.ja;u.$b=function(){this.qa="vanish"};u.$b.prototype=new u.ja;u.vb=function(){this.qa="repeat";this.qd=0;this.action=n;this.ia=[]};u.vb.prototype=new u.ja;u.vb.prototype.wa=function(a){this.root=a;this.action&&this.action.wa(a)};u.Vb=function(a,c){this.qa="bind";this.je=a;this.Rd=c};u.Vb.prototype=new u.ja;u.Zb=function(a,c){this.qa="notify";this.Od=a;this.ia=c||n};u.Zb.prototype=new u.ja;u.sd=new u.ja;u.Fa=function(a){this.type="aim";this.value=a||0};u.Ga=function(a){this.type=
"absolute";this.value=a===h?1:a};u.Yb=function(a){this.type="absolute";this.value=a||0};u.ac=function(a){this.type="absolute";this.value=a||0};u.Wb=function(a){a=a||{};this.offsetX=a.offsetX||0;this.offsetY=a.offsetY||0;this.ab=m;a.ab!==h&&(this.ab=!!a.ab)};u.Hc=function(a){this.value=a||0};u.Ic=function(a){this.value=a||0};u.Gc=function(a){this.value=!!a}})();(function(){u.Ia=function(b,a){this.Mc=b;this.yb=[];this.Ja=-1;this.la=n;this.da={};this.xb={oe:a||0}};u.Ia.prototype.next=function(){this.Ja+=1;if(this.la!==n){var b=this.la.xa[this.Ja];if(b!==h){if(b instanceof u.ra)return this.ib(),this.la=b,this.da=this.bc(),this.next();if(b instanceof u.Za)return this.ib(),this.la=this.Mc.Sd(b.label),this.da=this.cc(b.ia),this.next();if(b instanceof u.vb)return this.da.eb=0,this.da.gd=this.ma(b.qd)|0,this.ib(),this.la=b.action.clone(),this.da=this.bc(),this.next();
if(b instanceof u.$a){var a=new u.$a;a.ha=b.ha.clone(this);b.direction!==n&&(a.direction=new u.Fa(this.ma(b.direction.value)),a.direction.type=b.direction.type);b.speed!==n&&(a.speed=new u.Ga(this.ma(b.speed.value)),a.speed.type=b.speed.type);a.oa=b.oa;return a}return b instanceof u.Xb?(this.ib(),this.la=new u.ra,this.la.xa=[this.Mc.Wd(b.label)],this.da=this.cc(b.ia),this.next()):b instanceof u.tb?(a=new u.tb,a.direction.type=b.direction.type,a.direction.value=this.ma(b.direction.value),a.pa=this.ma(b.pa),
a):b instanceof u.ub?(a=new u.ub,a.speed.type=b.speed.type,a.speed.value=this.ma(b.speed.value),a.pa=this.ma(b.pa),a):b instanceof u.rb?(a=new u.rb,a.Ca.type=b.Ca.type,a.Ca.value=this.ma(b.Ca.value),a.Ea.type=b.Ea.type,a.Ea.value=this.ma(b.Ea.value),a.pa=this.ma(b.pa),a):b instanceof u.wb?new u.wb(this.ma(b.value)):b instanceof u.$b?b:b instanceof u.Vb?(this.da["$"+b.je]=this.ma(b.Rd),u.sd):b instanceof u.Zb?b:n}this.Gd();if(this.la===n)return n;if((b=this.la.xa[this.Ja])&&"repeat"==b.qa)this.da.eb++,
this.da.eb<this.da.gd&&(this.ib(),this.la=b.action.clone(),this.da=this.bc());return this.next()}return n};u.Ia.prototype.ib=function(){this.yb.push({action:this.la,cursor:this.Ja,scope:this.da});this.Ja=-1};u.Ia.prototype.Gd=function(){var b=this.yb.pop();b?(this.Ja=b.cursor,this.la=b.action,this.da=b.scope):(this.Ja=-1,this.la=n,this.da={})};u.Ia.prototype.ma=function(b){var a;if("number"===typeof b)return b;if(isNaN(a=Number(b))){if((a=this.da[b])||(a=this.xb[b]))return a;if("$rand"==b)return Math.random()}else return a;
a={};for(var c in this.xb)this.xb.hasOwnProperty(c)&&(a[c]=this.xb[c]);for(c in this.da)this.da.hasOwnProperty(c)&&(a[c]=this.da[c]);a.ne=Math.random();if(c=this.yb[this.yb.length-1])a.me={index:c.scope.eb,count:c.scope.eb+1,ze:0===c.scope.eb,last:c.scope.eb+1>=c.scope.gd};return eval("bulletml._temp = function() { return "+b.split("$").join("this.$")+"}").bind(a)()};u.Ia.prototype.cc=function(b){var a={};if(b)for(var c=0,f=b.length;c<f;c++)a["$"+(c+1)]=this.ma(b[c]);else for(c in this.da)this.da.hasOwnProperty(c)&&
(a[c]=this.da[c]);return a};u.Ia.prototype.bc=function(){var b={},a;for(a in this.da)this.da.hasOwnProperty(a)&&(b[a]=this.da[a]);return b};u.sa.prototype.qc=function(b,a){var c=new u.Ia(this,a),f=this.Yc(b);f&&(c.la=f);return c};u.Ha.prototype.qc=function(b){b=new u.Ia(this.root,b);var a=new u.ra;a.root=this.root;a.xa=this.ka;b.la=a;b.da=this.da;return b}})();u.ea=function(b){b=b||"";for(var a in u.ea)u.ea.hasOwnProperty(a)&&(u.td[b+a]=u.ea[a])};
u.ea.action=function(b){if(0<arguments.length)for(var a=0,c=arguments.length;a<c;a++)arguments[a]instanceof Function&&(arguments[a]=arguments[a]());if(b instanceof Array){a=0;for(c=b.length;a<c;a++)b[a]instanceof Function&&(b[a]=b[a]())}var f=new u.ra;if(b instanceof Array)b.some(function(a){return!(a instanceof u.ja)})&&d(Error("argument type error.")),f.xa=b;else{a=0;for(c=arguments.length;a<c;a++)arguments[a]instanceof u.ja?f.xa[a]=arguments[a]:d(Error("argument type error."))}return f};
u.ea.qe=function(b,a){for(var c=0,f=arguments.length;c<f;c++)arguments[c]instanceof Function&&(arguments[c]=arguments[c]());b===h&&d(Error("label is required."));f=new u.Za(b);if(a instanceof Array)f.ia=a;else for(c=1;c<arguments.length;c++)f.ia.push(arguments[c]);return f};
u.ea.ha=function(b,a,c,f){for(var g=0,k=arguments.length;g<k;g++)arguments[g]instanceof Function&&(arguments[g]=arguments[g]());k=new u.Ha;for(g=0;g<arguments.length;g++)arguments[g]instanceof u.Fa?k.direction=arguments[g]:arguments[g]instanceof u.Ga?k.speed=arguments[g]:arguments[g]instanceof u.ra?k.ka.push(arguments[g]):arguments[g]instanceof u.Za?k.ka.push(arguments[g]):arguments[g]instanceof Array?k.ka.push(u.ea.action(arguments[g])):arguments[g]instanceof Object?k.oa=arguments[g]:"string"===
typeof arguments[g]&&(k.label=arguments[g]);return k};u.ea.se=function(b,a){for(var c=0,f=arguments.length;c<f;c++)arguments[c]instanceof Function&&(arguments[c]=arguments[c]());b===h&&d(Error("label is required."));f=new u.sb(b);if(a instanceof Array)f.ia=a;else for(c=1;c<arguments.length;c++)f.ia.push(arguments[c]);return f};
u.ea.Kb=function(b,a,c,f){for(var g=0,k=arguments.length;g<k;g++)arguments[g]instanceof Function&&(arguments[g]=arguments[g]());k=new u.$a;for(g=0;g<arguments.length;g++)arguments[g]instanceof u.Fa?k.direction=arguments[g]:arguments[g]instanceof u.Ga?k.speed=arguments[g]:arguments[g]instanceof u.Ha?k.ha=arguments[g]:arguments[g]instanceof u.sb?k.ha=arguments[g]:arguments[g]instanceof u.Wb?k.oa=arguments[g]:arguments[g]instanceof u.Hc?k.oa.offsetX=arguments[g].value:arguments[g]instanceof u.Ic?k.oa.offsetY=
arguments[g].value:arguments[g]instanceof u.Gc&&(k.oa.ab=arguments[g].value);k.ha===h&&d(Error("bullet (or bulletRef) is required."));return k};u.ea.ye=function(b,a){for(var c=0,f=arguments.length;c<f;c++)arguments[c]instanceof Function&&(arguments[c]=arguments[c]());b===h&&d(Error("label is required."));f=new u.Xb(b);if(a instanceof Array)f.ia=a;else for(c=1;c<arguments.length;c++)f.ia.push(arguments[c]);return f};
u.ea.te=function(b,a){for(var c=0,f=arguments.length;c<f;c++)arguments[c]instanceof Function&&(arguments[c]=arguments[c]());b===h&&d(Error("direction is required."));a===h&&d(Error("term is required."));c=new u.tb;c.direction=b instanceof u.Fa?b:new u.Fa(b);c.pa=a;return c};
u.ea.ue=function(b,a){for(var c=0,f=arguments.length;c<f;c++)arguments[c]instanceof Function&&(arguments[c]=arguments[c]());b===h&&d(Error("speed is required."));a===h&&d(Error("term is required."));c=new u.ub;c.speed=b instanceof u.Ga?b:new u.Ga(b);c.pa=a;return c};
u.ea.pe=function(b,a,c){for(var f=0,g=arguments.length;f<g;f++)arguments[f]instanceof Function&&(arguments[f]=arguments[f]());g=new u.rb;for(f=0;f<arguments.length;f++)arguments[f]instanceof u.Yb?g.Ca=b:arguments[f]instanceof u.ac?g.Ea=a:g.pa=arguments[f];g.Ca===h&&g.Ea===h&&d(Error("horizontal or vertical is required."));g.pa===h&&d(Error("term is required."));return g};
u.ea.wait=function(b){for(var a=0,c=arguments.length;a<c;a++)arguments[a]instanceof Function&&(arguments[a]=arguments[a]());b===h&&d(Error("value is required."));return new u.wb(b)};u.ea.Ke=function(){return new u.$b};
u.ea.repeat=function(b,a){for(var c=0,f=arguments.length;c<f;c++)arguments[c]instanceof Function&&(arguments[c]=arguments[c]());b===h&&d(Error("times is required."));a===h&&d(Error("action is required."));f=new u.vb;f.qd=b;if(a instanceof u.ra||a instanceof u.Za)f.action=a;else if(a instanceof Array)f.action=u.ea.action(a);else{for(var g=[],c=1;c<arguments.length;c++)g.push(arguments[c]);f.action=u.ea.action(g)}return f};u.ea.re=function(b,a){return new u.Vb(b,a)};
u.ea.He=function(b,a){return new u.Zb(b,a)};u.ea.direction=function(b,a){for(var c=0,f=arguments.length;c<f;c++)arguments[c]instanceof Function&&(arguments[c]=arguments[c]());b===h&&d(Error("value is required."));c=new u.Fa(b);a!==h&&(c.type=a);return c};u.ea.speed=function(b,a){for(var c=0,f=arguments.length;c<f;c++)arguments[c]instanceof Function&&(arguments[c]=arguments[c]());b===h&&d(Error("value is required."));c=new u.Ga(b);a&&(c.type=a);return c};
u.ea.Ca=function(b,a){for(var c=0,f=arguments.length;c<f;c++)arguments[c]instanceof Function&&(arguments[c]=arguments[c]());b===h&&d(Error("value is required."));c=new u.Yb(b);a&&(c.type=a);return c};u.ea.Ea=function(b,a){for(var c=0,f=arguments.length;c<f;c++)arguments[c]instanceof Function&&(arguments[c]=arguments[c]());b===h&&d(Error("value is required."));c=new u.ac(b);a&&(c.type=a);return c};u.ea.xe=function(b){return new u.Wb(b)};u.ea.offsetX=function(b){return new u.Hc(b)};u.ea.offsetY=function(b){return new u.Ic(b)};
u.ea.ab=function(b){return new u.Gc(b)};tm.na=tm.na||{};
(function(){function b(a){for(;a<=-Math.PI;)a+=2*Math.PI;for(;Math.PI<a;)a-=2*Math.PI;return a}function a(a,c){return Math.atan2(c.y-a.y,c.x-a.x)}tm.na.Pa=tm.createClass({init:function(a){a||d(Error("argument is invalid.",a));this.Jc=a},Hb:function(a,c){var b=this.Jc.Yd();if(c===h&&0<b.length){for(var f=[],l=0,C=b.length;l<C;l++)f[f.length]=this.Kc(a,b[l]);for(var s=function(){for(var a=f.length;a--;)f[a].call(this);s.mc==f.length&&(s.kb=m,this.dispatchEvent(tm.event.Event("completeattack")))},l=
f.length;l--;)f[l].Sb=s;s.mc=0;s.Qc=function(){this.mc++};s.mc=0;s.kb=p;s.tc=m;return s}return this.Kc(a,c)},Kc:function(a,c){function b(){b.ga+=1;this.ga=b.ga;var a=b.nc,c=b.Fd;if(c)if(b.ga<b.jc?b.direction+=b.cb:b.ga===b.jc&&(b.direction=b.La),b.ga<b.kc?b.speed+=b.qb:b.ga===b.kc&&(b.speed=b.gb),b.ga<b.ec?(b.Wa+=b.Bb,b.Ya+=b.Cb):b.ga===b.ec&&(b.Wa=b.zb,b.Ya=b.Ab),this.x+=Math.cos(b.direction)*b.speed*a.Xa,this.y+=Math.sin(b.direction)*b.speed*a.Xa,this.x+=b.Wa*a.Xa,this.y+=b.Ya*a.Xa,a.vc(this)){if(a.hb||
this.hb)this.rotation=(b.direction+0.5*Math.PI)*Math.RAD_TO_DEG,this.speed=b.speed;if(!(b.ga<b.Ub||b.kb)){for(var g;g=b.rd.next();)switch(g.qa){case "fire":c.Cd.call(this,g,a,b,c);break;case "wait":a=0;"number"===typeof g.value?b.Ub=b.ga+g.value:0!==(a=~~g.value)?b.Ub=b.ga+a:b.Ub=b.ga+eval(g.value);return;case "changeDirection":c.wd.call(this,g,a,b);break;case "changeSpeed":c.xd.call(this,g,b);break;case "accel":c.ud.call(this,g,b);break;case "vanish":this.remove();break;case "notify":c.Dd.call(this,
g)}b.kb=m;b.Sb?b.Sb.Qc():this.dispatchEvent(tm.event.Event("completeattack"))}}else this.remove(),b.kb=m,b.Sb?b.Sb.Qc():this.dispatchEvent(tm.event.Event("completeattack"))}a=function(a){var b={},c=tm.na.Pa.lb,g;for(g in c)c.hasOwnProperty(g)&&(b[g]=c[g]);for(g in a)a.hasOwnProperty(g)&&(b[g]=a[g]);return b}(a);a.target||d(Error("target is undefined in config."));c=c||"top";"string"===typeof c?b.rd=this.Jc.qc(c,a.md):c instanceof u.Ha?b.rd=c.qc(a.md):(window.console.error(a,c),d(Error("\u5f15\u6570\u304c\u4e0d\u6b63")));
b.Fd=this;b.nc=a;b.Ub=-1;b.kb=p;b.direction=0;b.dd=0;b.speed=0;b.fd=0;b.Wa=0;b.Ya=0;b.cb=0;b.La=0;b.jc=-1;b.qb=0;b.gb=0;b.kc=-1;b.Bb=0;b.zb=0;b.Cb=0;b.Ab=0;b.ec=-1;b.ga=-1;b.tc=m;return b},Bd:function(a){function b(){this.x+=b.Sc;this.y+=b.Tc;b.nc.vc(this)||(this.remove(),this.dispatchEvent(tm.event.Event("removed")))}a=function(a){var b={},c=tm.na.Pa.lb,g;for(g in c)c.hasOwnProperty(g)&&(b[g]=c[g]);for(g in a)a.hasOwnProperty(g)&&(b[g]=a[g]);return b}(a);a.target||d(Error("target is undefined in config."));
b.nc=a;b.direction=0;b.speed=0;b.Sc=0;b.Tc=0;b.tc=m;return b},Cd:function(b,c,f,t){var l={label:b.ha.label},C;for(C in b.ha.oa)l[C]=b.ha.oa[C];if(l=c.Oc(l)){var s=(C=!!b.ha.ka.length)?t.Bd(c):t.Hb(c,b.ha),S=this,J={x:this.x+b.oa.offsetX,y:this.y+b.oa.offsetY};f.dd=s.direction=function(l){var t=eval(l.value)*Math.DEG_TO_RAD;switch(l.type){case "aim":return c.target?b.oa.ab?a(J,c.target)+t:a(S,c.target)+t:t-Math.PI/2;case "absolute":return t-Math.PI/2;case "relative":return f.direction+t;default:return f.dd+
t}}(b.direction||b.ha.direction);f.fd=s.speed=function(a){var b=eval(a.value);switch(a.type){case "relative":return f.speed+b;case "sequence":return f.fd+b;default:return b}}(b.speed||b.ha.speed);l.x=J.x;l.y=J.y;C&&(s.Sc=Math.cos(s.direction)*s.speed*c.Xa,s.Tc=Math.sin(s.direction)*s.speed*c.Xa);l.hb=!!l.hb;if(c.hb||l.hb)l.rotation=(s.direction+0.5*Math.PI)*Math.RAD_TO_DEG,l.speed=s.speed;l.addEventListener("enterframe",s);l.addEventListener("removed",function(){this.removeEventListener("enterframe",
s);this.removeEventListener("removed",arguments.callee)});c.Nc?c.Nc.addChild(l):this.parent&&this.parent.addChild(l);c.be(l)}},wd:function(c,f,r){var t=eval(c.direction.value)*Math.DEG_TO_RAD,l=eval(c.pa);switch(c.direction.type){case "aim":c=f.target;if(!c)return;r.La=a(this,c)+t;r.cb=b(r.La-r.direction)/l;break;case "absolute":r.La=t-Math.PI/2;r.cb=b(r.La-r.direction)/l;break;case "relative":r.La=r.direction+t;r.cb=b(r.La-r.direction)/l;break;case "sequence":r.cb=t,r.La=r.direction+r.cb*(l-1)}r.jc=
r.ga+l},xd:function(a,b){var c=eval(a.speed.value),f=eval(a.pa);switch(a.speed.type){case "absolute":b.gb=c;b.qb=(b.gb-b.speed)/f;break;case "relative":b.gb=c+b.speed;b.qb=(b.gb-b.speed)/f;break;case "sequence":b.qb=c,b.gb=b.speed+b.qb*f}b.kc=b.ga+f},ud:function(a,b){var c=eval(a.pa);b.ec=b.ga+c;if(a.Ca){var f=eval(a.Ca.value);switch(a.Ca.type){case "absolute":case "sequence":b.Bb=(f-b.Wa)/c;b.zb=f;break;case "relative":b.Bb=f,b.zb=(f-b.Wa)*c}}else b.Bb=0,b.zb=b.Wa;if(a.Ea)switch(f=eval(a.Ea.value),
a.Ea.type){case "absolute":case "sequence":b.Cb=(f-b.Ya)/c;b.Ab=f;break;case "relative":b.Cb=f,b.Ab=(f-b.Ya)*c}else b.Cb=0,b.Ab=b.Ya},Dd:function(a){var b=tm.event.Event(a.Od);if(a.ia)for(var c in a.ia)b[c]=a.ia[c];this.dispatchEvent(b)}});var c=function(){var a=tm.graphics.Canvas();a.resize(8,8);a.setTransformCenter();a.setLineStyle(0).setStrokeStyle("rgba(0,0,0,0)");a.setFillStyle(tm.graphics.RadialGradient(0,0,0,0,0,4).addColorStopList([{offset:0,color:"white"},{offset:0.5,color:"white"},{offset:1,
color:"red"}]).toStyle()).fillCircle(0,0,4);return a}();tm.na.Kd=function(a){var b=tm.app.Sprite(8,8,c);b.label=a.label;return b};var f=n;tm.na.Ld=function(a){f===n&&(f=a.getRoot());return 0<=a.x&&a.x<APP.width&&0<=a.y&&a.y<APP.height};tm.na.Md=q();tm.na.Pa.lb={Oc:tm.na.Kd,vc:tm.na.Ld,be:tm.na.Md,md:0,hb:p,Xa:2,target:n};u.sa.prototype.Hb=function(a){return tm.na.Pa(this).Hb(a)}})();/*
 gls2.js v1.0-beta

 License
 http://daishihmr.mit-license.org/
*/
tm.preload(function(){tm.util.ScriptManager.loadStats()});tm.main(function(){var b=v("#canvas2d");b.enableStats();b.run()});var w=n,z,A,B,D,E,F,G,H,I,K,L,M,v=tm.createClass({superClass:tm.app.CanvasApp,ad:0,De:0,Db:4,fb:4,Uc:1,fa:n,init:function(b){this.superInit(b);w=this;this.resize(480,640).fitWindow();this.fps=60;this.background="black";this.keyboard=tm.input.Keyboard(window);this.replaceScene(tm.app.LoadingScene({assets:{tex0:"assets/tex0.png",tex1:"assets/tex1.png",laser:"assets/laser.png",laserHead:"assets/laser_head.png",laserFoot:"assets/laser_foot.png",explode0:"assets/explode0.png",explode1:"assets/explode1.png",
explode2:"assets/explode2.png",explode3:"assets/explode3.png",soundExplode:"assets/sen_ge_taihou03.mp3"},nextScene:function(){this.Ed();return z()}.bind(this)}))},Ed:function(){N.Aa();O.Aa();A.Aa();P.Aa();this.fa=B()},Pd:function(){this.stop();tm.social.Nineleap.postRanking(this.ad,"")}});function Q(b){b.shadowColor="rgba(0,0,0,0.5)";b.shadowBlur=30;b.shadowOffsetX=20;b.shadowOffsetY=70}
tm.app.Label=tm.createClass({superClass:tm.app.Label,init:function(b,a){this.superInit(b,a);this.setAlign("center");this.setBaseline("middle");this.setFontFamily("Orbitron");this.fillStyle="white";this.isHitPoint=this.isHitPointRect},update:function(b){this.alpha=0.8+0.2*Math.sin(0.1*b.frame)}});
var R=tm.createClass({superClass:tm.app.RectangleShape,label:n,ta:n,init:function(b){this.superInit(b,64,{fillStyle:"rgba(1,2,48,0.5)",strokeStyle:"rgba(0,0,0,0)"});this.label=tm.app.Label("_",10).setAlign("left").setBaseline("top").setPosition(-this.width/2+4,-this.height/2+4).setFillStyle("rgba(255,255,255,0.5)").addChildTo(this);this.ta=[]},Hd:function(b){5<this.ta.length&&this.ta.splice(1,this.ta.length-4);this.ta.push(b);return this},Id:function(){this.ta.clear();return this},clear:function(){this.label.text=
"_";return this},update:function(b){var a=this.label.text,a=a.substring(0,a.length-1);if(0===b.frame%2&&0!==this.ta.length)if(""!==this.ta[0]){var c=this.ta[0][0];this.ta[0]=this.ta[0].substring(1);a+=c}else this.ta.shift(),c=a.split("\n"),3<c.length&&(c.shift(),a=c.join("\n")),a+="\n";this.label.text=a+(~~(b.frame/6)%2?"_":" ")}});function T(){if(0!==w.fb){var b=tm.asset.AssetManager.get("soundExplode");b.volume=0.1*w.fb;b&&b.clone().play()}}
tm.app.AnimationSprite.prototype.clone=function(){return tm.app.AnimationSprite(this.ss,this.width,this.height)};(function(){var b=n,a={0:{x:1,y:0},45:{x:0.7,y:-0.7},90:{x:0,y:-1},135:{x:-0.7,y:-0.7},180:{x:-1,y:0},225:{x:-0.7,y:0.7},270:{x:0,y:1},315:{x:0.7,y:0.7}};D=tm.createClass({superClass:tm.app.Sprite,za:0,Sa:m,hd:p,fa:n,Zd:100,speed:4.5,bb:[{x:-70,y:20,d:0.1,Tb:p,Jb:-0.7,v:m},{x:-40,y:40,d:0.1,Tb:p,Jb:-0.5,v:m},{x:40,y:40,d:0.1,Tb:m,Jb:0.5,v:m},{x:70,y:20,d:0.1,Tb:m,Jb:0.7,v:m}],ob:n,Nb:n,Eb:n,Ob:n,Pb:n,init:function(a){this.superInit("tex1",64,64);this.fa=a;tm.na.Pa.lb.target=this;Q(this);this.ob=E(this,
"laser","laserHead","laserFoot");this.ob.visible=p;this.ob.addChildTo(a);this.Ad();this.Eb=tm.app.CanvasElement().addChildTo(this);a=0;for(var b=this.bb.length;a<b;a++){var g=this.bb[a];F(this,g).setPosition(g.x,g.y).addChildTo(this.Eb)}this.Ob=tm.app.CircleShape(80,80,{fillStyle:"rgba(0,0,0,0)",strokeStyle:tm.graphics.LinearGradient(0,0,0,80).addColorStopList([{offset:0,color:"rgba(100,100,255,0.0)"},{offset:0.3,color:"rgba(100,100,255,0.1)"},{offset:0.5,color:"rgba(255,255,255,1.0)"},{offset:0.7,
color:"rgba(100,100,255,0.1)"},{offset:1,color:"rgba(100,100,255,0.0)"}]).toStyle(),lineWidth:2}).addChildTo(this);this.Ob.blendMode="lighter";this.Ob.update=function(){this.rotation+=2};this.Pb=tm.app.CircleShape(80,80,{fillStyle:"rgba(0,0,0,0)",strokeStyle:tm.graphics.LinearGradient(0,0,0,80).addColorStopList([{offset:0,color:"rgba(100,100,255,0.0)"},{offset:0.3,color:"rgba(100,100,255,0.1)"},{offset:0.5,color:"rgba(255,255,255,1.0)"},{offset:0.7,color:"rgba(100,100,255,0.1)"},{offset:1,color:"rgba(100,100,255,0.0)"}]).toStyle(),
lineWidth:2}).addChildTo(this);this.Pb.blendMode="lighter";this.Pb.update=function(){this.rotation-=2}},Ad:function(){this.Nb=tm.app.Sprite("tex0",20,20).addChildTo(this);this.Nb.setFrameIndex(5);this.Nb.blendMode="lighter";this.Nb.update=function(a){a=0.75+0.15*Math.sin(0.2*a.frame);this.scale.set(a,a)}},Oa:-1,pc:p,mb:p,update:function(c){var f=c.keyboard;if(this.Sa){var g=f.getKeyAngle();g!==n&&(g=a[g],this.x+=g.x*this.speed*(this.mb?0.75:1),this.y+=g.y*this.speed*(this.mb?0.75:1));this.x=Math.clamp(this.x,
5,475);this.y=Math.clamp(this.y,5,635);var g=f.getKey("c"),k=f.getKey("z");this.Oa=g?this.Oa+1:this.Oa-1;this.Oa=Math.clamp(this.Oa,-1,10);this.mb=k&&g||10===this.Oa;this.pc=!this.mb&&(0<=this.Oa||k)&&0===c.frame%3;k&&(this.Oa=0);if(this.mb){this.ob.visible=m;g=0;for(k=this.bb.length;g<k;g++)this.bb[g].v=p;this.Eb.rotation=0}else{this.ob.visible=p;g=0;for(k=this.bb.length;g<k;g++)this.bb[g].v=m}this.pc&&(c=Math.sin(0.2*c.frame),G(this.x-7-6*c,this.y-5,-90).addChildTo(this.fa),G(this.x-7+6*c,this.y-
5,-90).addChildTo(this.fa),G(this.x+7-6*c,this.y-5,-90).addChildTo(this.fa),G(this.x+7+6*c,this.y-5,-90).addChildTo(this.fa))}this.Ob.visible=this.Pb.visible=100===this.Zd;this.Jd(f);this.vd(f);b===n&&(b=H(this.fa.ya));b.clone().setPosition(this.x-5,this.y+20).addChildTo(this.fa);b.clone().setPosition(this.x+5,this.y+20).addChildTo(this.fa)},Jd:function(a){var b=this.Eb;this.Sa&&a.getKey("left")?b.rotation=Math.max(b.rotation-2,-30):this.Sa&&a.getKey("right")?b.rotation=Math.min(b.rotation+2,30):
b.rotation=2<b.rotation?b.rotation-2:-2>b.rotation?b.rotation+2:0},vd:function(a){this.Sa&&a.getKey("left")?this.za=Math.clamp(this.za-0.2,-3,3):this.Sa&&a.getKey("right")?this.za=Math.clamp(this.za+0.2,-3,3):0>this.za?this.za=Math.clamp(this.za+0.2,-3,3):0<this.za&&(this.za=Math.clamp(this.za-0.2,-3,3));a=3+~~this.za;this.setFrameIndex(a);return a}});F=tm.createClass({superClass:tm.app.AnimationSprite,Qa:n,ca:n,init:function(a,b){this.superInit(tm.app.SpriteSheet({image:"tex1",frame:{width:32,height:32},
animations:{anim0:{frames:[136,137,138,152,153,154],next:"anim0",frequency:3},anim1:{frames:[137,138,152,153,154,136].reverse(),next:"anim1",frequency:3}}}),32,32);this.Qa=b;this.ca=a;Q(this);this.gotoAndPlay(b.Tb?"anim0":"anim1")},update:function(a){if(this.Qa.v){this.x=this.Qa.x;this.y=this.Qa.y;this.rotation=Math.radToDeg(this.Qa.d*this.Qa.Jb);var f=this.parent.localToGlobal(this);this.Qa.v&&b.clone().setPosition(f.x,f.y).addChildTo(a.fa);this.ca.pc&&(G(f.x-3,f.y,this.parent.rotation+this.rotation-
90).addChildTo(a.fa),G(f.x+3,f.y,this.parent.rotation+this.rotation-90).addChildTo(a.fa))}else this.x=0,this.y=-40,this.currentFrameIndex=3}})})();(function(){var b=n;G=tm.createClass({superClass:tm.app.CircleShape,speed:20,hc:1,init:function(c,f,g){this.superInit(24,24,{fillStyle:tm.graphics.RadialGradient(12,12,0,12,12,12).addColorStopList([{offset:0,color:"rgba(255,255,255,1)"},{offset:0.5,color:"rgba(255,255,255,1)"},{offset:1,color:"rgba(  0,100,255,0)"}]).toStyle(),strokeStyle:"rgba(0,0,0,0)"});this.blendMode="lighter";this.scaleY=0.5;var k=Math.degToRad(g);this.ke=Math.cos(k)*this.speed;this.le=Math.sin(k)*this.speed;this.setPosition(c,
f);this.rotation=g;this.addEventListener("added",function(){a.push(this)});this.addEventListener("removed",function(){var b=a.indexOf(this);-1!==b&&a.splice(b,1)});b===n&&(b=I(16,1,0.9,tm.graphics.Canvas().resize(16,16).setFillStyle(tm.graphics.RadialGradient(8,8,0,8,8,8).addColorStopList([{offset:0,color:"rgba(255,255,255,1.0)"},{offset:1,color:"rgba(255,128,  0,0.0)"}]).toStyle()).fillRect(0,0,16,16).element))},update:function(){this.x+=this.ke;this.y+=this.le;for(var a=[].concat(K.fc),b=0,g=a.length;b<
g;b++){var k=a[b];if((this.x-k.x)*(this.x-k.x)+(this.y-k.y)*(this.y-k.y)<(this.radius+k.radius)*this.radius+k.radius){this.nb();k.Rc(this.hc);this.remove();break}}(-60>this.x||540<this.x||-60>this.y||700<this.y)&&this.remove()},nb:function(){var a=b.clone().setPosition(this.x,this.y).addChildTo(this.parent),f=Math.randf(2,8),g=2*Math.random()*Math.PI;a.ua=Math.cos(g)*f;a.va=Math.sin(g)*f;a.scaleX=a.scaleY=(Math.randf(0.1,0.5)+Math.randf(0.1,0.5))/2;a.addEventListener("enterframe",function(){this.x+=
this.ua;this.y+=this.va;this.ua*=0.9;this.va*=0.9})}});G.jb=function(){for(var b=[].concat(a),f=0,g=b.length;f<g;f++)b[f].remove()};var a=G.fc=[]})();(function(){var b=n;E=tm.createClass({superClass:tm.app.CanvasElement,ca:n,image:n,c:n,ga:0,Ba:0,Ie:n,hc:5,ic:p,head:n,Ta:n,init:function(a,c,f,g){this.ca=a;a=tm.asset.AssetManager.get(c);this.superInit();this.image=a.element;this.width=a.width;this.height=640;this.blendMode="lighter";this.origin.y=1;this.c=tm.graphics.Canvas();this.c.resize(this.width,740);this.c.globalCompositeOperation="lighter";this.head=tm.app.AnimationSprite(tm.app.SpriteSheet({image:f,frame:{width:80,height:80},animations:{"default":{frames:[0,
1,2,3],next:"default"}}}),80,80);this.head.gotoAndPlay();this.head.blendMode="lighter";this.Ta=tm.app.AnimationSprite(tm.app.SpriteSheet({image:g,frame:{width:128,height:64},animations:{"default":{frames:[0,1,2,3],next:"default"}}}),128,64);this.Ta.gotoAndPlay();this.Ta.blendMode="lighter";b===n&&(b=I(16,1,0.9,tm.graphics.Canvas().resize(16,16).setFillStyle(tm.graphics.RadialGradient(8,8,0,8,8,8).addColorStopList([{offset:0,color:"rgba(255,255,255,1.0)"},{offset:1,color:"rgba(  0,  0,255,0.0)"}]).toStyle()).fillRect(0,
0,16,16).element))},update:function(a){this.x=this.ca.x;this.y=this.ca.y-40;if(this.visible){this.Ba=this.ic?this.Ba-50:this.y;var b=[].concat(K.fc);b.sort(function(a,b){return b.y-a.y});for(var f=0,g=b.length;f<g;f++){var k=b[f];this.Ba-30<k.y&&(k.y<this.y&&this.x-40<k.x&&k.x<this.x+40)&&(k.Rc(this.hc)?this.nb(3):this.Ba=k.y,0===a.frame%2&&this.nb(2))}this.head._updateFrame();this.Ta._updateFrame()}else{if(this.ic)for(a=this.y;a>this.Ba;a-=30)this.nb(1,a);this.Ba=this.y}-80>this.Ba&&(this.Ba=-80);
this.ic=this.visible;this.ga+=1},nb:function(a,c){c=c||this.Ba;for(var f=0;f<a;f++){var g=b.clone().setPosition(this.x,c).addChildTo(this.parent),k=Math.randf(8,14),r=Math.randf(0,Math.PI);g.ua=Math.cos(r)*k;g.va=Math.sin(r)*k;g.scaleX=g.scaleY=(Math.randf(0.5,1.5)+Math.randf(0.5,1.5))/2;g.addEventListener("enterframe",function(){this.x+=this.ua;this.y+=this.va;this.ua*=0.9;this.va*=0.9})}},draw:function(a){this.c.clear();for(var b=0;6>b;b++)this.c.drawImage(this.image,0,-(15*this.ga%240)+240*b);
this.height=Math.max(this.y-this.Ba,1);a.context.drawImage(this.c.element,0,this.c.height-this.height,this.c.width,this.height,-this.width*this.origin.x,-this.height*this.origin.y,this.width,this.height);var b=this.head.ss.getFrame(this.head.currentFrame),f=this.head.ss.image.element;a.drawImage(f,b.x,b.y,b.width,b.height,-this.width*this.origin.x-43,-this.height*this.origin.y-75,150,150);b=this.Ta.ss.getFrame(this.Ta.currentFrame);f=this.Ta.ss.image.element;a.drawImage(f,b.x,b.y,b.width,b.height,
-this.width*this.origin.x-43,-this.height*this.origin.y+this.height-37,150,74)}})})();var U=tm.createClass({Je:0,Fe:0,we:0,ca:n,fa:n,frame:0,init:function(b){var a=this.fa=b;this.ca=b.ca;a.ya.direction=0.5*Math.PI;a.ya.speed=2},update:function(){if(200<this.frame&&0===this.frame%30){var b,a=Math.rand(0,5);0===a?b=L["heri2-left"]:1===a?b=L["heri2-center"]:2===a?b=L["heri2-right"]:3===a?b=L["heri1-left"]:4===a?b=L["heri1-center"]:5===a&&(b=L["heri1-right"]);for(var a=0,c=b.length;a<c;a++)this.ae(b[a])}this.frame+=1},ae:function(b){return K(this.fa,b.aa,b.ba).setPosition(b.x,b.y).addChildTo(this.fa).Va()}});
U.create=function(b){return U(b)};var P={Aa:function(){P.explosion=Array.range(0,4).map(function(b){return tm.app.AnimationSprite(tm.app.SpriteSheet({image:"explode"+b,frame:{width:100,height:100},animations:{"default":{frame:Array.range(0,25),next:n}}},100,100))});P.shockwave=tm.app.CircleShape(100,100,{strokeStyle:"rgba(0,0,0,0)",fillStyle:tm.graphics.RadialGradient(50,50,0,50,50,50).addColorStopList([{offset:0,color:"rgba(255,255,255,0)"},{offset:0.7,color:"rgba(255,255,255,0)"},{offset:0.95,color:"rgba(255,255,255,1)"},{offset:1,
color:"rgba(255,255,255,0)"}]).toStyle()})},Qd:function(b,a,c){T();b=this.explosion[Math.rand(0,3)].clone().addEventListener("animationend",function(){this.remove()}).setPosition(b,a).setRotation(360*Math.random()).setBlendMode("lighter").gotoAndPlay();b.$d=m;b.addChildTo(c)}};var X=tm.createClass({superClass:tm.app.Scene,dc:-1,init:function(){this.superInit()},finish:function(b){var a=this.app;a.popScene();(a=a.currentScene)&&-1!==a.dc&&a.xc(a.dc,b)},pd:function(b,a){this.dc=b;"function"===typeof a?this.app.pushScene(a()):a instanceof tm.app.Scene&&this.app.pushScene(a)},Da:function(b,a,c,f,g,k){k===h&&(k=m);this.pd(b,V(a,c,f,g,k))},xc:q(),update:function(b){b.pointing.getPointingEnd()&&W(b.pointing).addChildTo(this)}}),W=tm.createClass({superClass:tm.app.CircleShape,
init:function(b){this.superInit(150,150,{strokeStyle:"rgba(0,0,0,0)",fillStyle:tm.graphics.RadialGradient(75,75,0,75,75,75).addColorStopList([{offset:0,color:"rgba(255,255,255,0.0)"},{offset:0.6,color:"rgba(255,255,255,0.0)"},{offset:1,color:"rgba(255,255,255,0.8)"}]).toStyle()});this.setPosition(b.x,b.y);this.width=this.height=1;this.tweener.clear().to({width:150,height:150,alpha:0},300,"easeOutQuad").call(function(){this.remove()}.bind(this))}});var V=tm.createClass({superClass:X,title:n,selection:[],selected:0,Ib:n,description:n,Ra:n,kd:p,Zc:p,cursor:n,nd:p,init:function(b,a,c,f,g){this.superInit();this.Ib=f?f:[].concat(a);g&&(a.push("exit"),this.Ib.push("\u524d\u306e\u753b\u9762\u3078\u623b\u308a\u307e\u3059"));this.nd=!!g;c!==h&&(this.selected=c);c=function(){var c=320-25*a.length;this.title=tm.app.Label(b,30).setPosition(240,c).addChildTo(this);this.selection=a.map(function(a,b){var f=this;c+=50;var g=tm.app.Label(a).setPosition(240,
c).addChildTo(this);g.interactive=m;g.addEventListener("touchend",function(){f.selected===b?f.lc(f.selected):f.selected=b});g.width=336;return g}.bind(this));this.yd();this.kd=m}.bind(this);f=Math.max(50*(1+a.length),50)+40;this.Ra=tm.app.RectangleShape(384,f,{strokeStyle:"rgba(0,0,0,0)",fillStyle:"rgba(1,2,48,0.8)"}).setPosition(240,320);this.Ra.width=1;this.Ra.height=1;this.Ra.tweener.to({width:384,height:f},200,"easeOutExpo").call(c);this.Ra.addChildTo(this);this.description=tm.app.Label("",14).setPosition(240,
630).addChildTo(this)},yd:function(){this.cursor=tm.app.RectangleShape(336,10,{strokeStyle:"rgba(0,0,0,0)",fillStyle:tm.graphics.LinearGradient(0,0,336,0).addColorStopList([{offset:0,color:"rgba(  0,255,100,0.0)"},{offset:0.2,color:"rgba(  0,255,100,0.3)"},{offset:0.5,color:"rgba(  0,255,255,0.5)"},{offset:0.8,color:"rgba(  0,255,100,0.3)"},{offset:1,color:"rgba(  0,255,100,0.0)"}]).toStyle()}).addChildTo(this);this.cursor.blendMode="lighter";this.cursor.x=240;this.cursor.s=this.selected;this.cursor.y=
this.selection[this.selected].y;this.cursor.update=function(){this.s!==this.parent.selected&&(this.s=this.parent.selected,this.tweener.clear(),this.tweener.to({y:this.parent.selection[this.parent.selected].y},200,"easeOutExpo"))}},update:function(b){this.superClass.prototype.update.apply(this,arguments);this.Ib!==n&&(this.description.text=this.Ib[this.selected]);this.kd&&(this.Zc?this.cursor.visible=0===~~(b.frame/2)%2:this.nd&&b.keyboard.getKeyDown("x")?(this.selected=this.selection.length-1,this.lc(this.selected)):
b.keyboard.getKeyDown("z")||b.keyboard.getKeyDown("space")?this.lc(this.selected):b.keyboard.getKeyDown("down")?(this.selected+=1,this.selected=Math.clamp(this.selected,0,this.selection.length-1)):b.keyboard.getKeyDown("up")&&(this.selected-=1,this.selected=Math.clamp(this.selected,0,this.selection.length-1)))},lc:function(b){this.Zc=m;this.tweener.clear().wait(200).call(function(){this.cursor.remove();this.title.remove();this.selection.each(function(a){a.remove()});this.Ra.tweener.clear();this.Ra.tweener.to({width:1,
height:1},200,"easeInExpo").call(function(){this.finish(b)}.bind(this))}.bind(this))},draw:function(b){b.fillStyle="rgba(0,0,0,0.8)";b.fillRect(0,0,480,640)},toString:function(){return"gls2.DialogMenu"}});I=tm.createClass({superClass:tm.app.CanvasElement,alpha:1,gc:0.85,size:0,image:n,init:function(b,a,c,f){this.superInit();this.width=this.height=this.size=b;a!==h&&(this.alpha=a);c!==h&&(this.gc=c);this.blendMode="lighter";this.image=f?f:tm.graphics.Canvas().resize(b,b).setFillStyle(tm.graphics.RadialGradient(0.5*b,0.5*b,0,0.5*b,0.5*b,0.5*b).addColorStopList([{offset:0,color:"rgba(255,255,255,0.1)"},{offset:1,color:"rgba(  0,  0,  0,0.0)"}]).toStyle()).fillRect(0,0,b,b).element},update:function(){this.alpha*=
this.gc;0.0010>this.alpha?this.remove():1<this.alpha&&(this.alpha=1)},draw:function(b){b.context.drawImage(this.image,-this.width*this.origin.x,-this.height*this.origin.y,this.width,this.height)},clone:function(){return I(this.size,this.Ee,this.gc,this.image)}});
H=tm.createClass({superClass:I,ya:n,init:function(b){this.superInit(20,1,0.8,tm.graphics.Canvas().resize(20,20).setFillStyle(tm.graphics.RadialGradient(10,10,0,10,10,10).addColorStopList([{offset:0,color:"rgba(255,255,255,0.5)"},{offset:1,color:"rgba(  0,  0,  0,0.0)"}]).toStyle()).fillRect(0,0,20,20).element);this.ya=b},update:function(b){this.superClass.prototype.update.apply(this,b);this.x+=this.ya.ua;this.y+=this.ya.va+0.2},clone:function(){return H(this.ya)}});(function(){var b=n,a=n;z=tm.createClass({superClass:X,result:n,ga:0,pb:[],Mb:p,bd:n,ed:0,Qb:0,init:function(){this.superInit();tm.app.Label("GL-Shooter 2",50).setPosition(240,160).addChildTo(this);tm.app.Label("version 1.0-beta",22).setPosition(432,192).setAlign("right").addChildTo(this);this.bd=tm.app.Label().setPosition(240,256).addChildTo(this);tm.app.Label("press space key").setPosition(240,576).addChildTo(this);this.addEventListener("enter",function(){this.Mb=p;this.bd.text="HIGH SCORE: "+w.ad})},
draw:function(a){a.fillStyle="black";a.fillRect(0,0,480,640)},update:function(a){this.Lc(80*Math.cos(0.01*this.ga)+240,80*Math.sin(0.01*this.ga)+320,0);this.Lc(80*Math.cos(0.01*this.ga+Math.PI)+240,80*Math.sin(0.01*this.ga+Math.PI)+320,1);(a.keyboard.getKeyDown("space")||a.pointing.getPointingEnd())&&!this.Mb&&this.jd();this.ga+=1},Lc:function(c,f,g){if(!this.Mb){b===n&&(b=I(80,1,0.8,tm.graphics.Canvas().resize(80,80).setFillStyle(tm.graphics.RadialGradient(40,40,0,40,40,40).addColorStopList([{offset:0,
color:"rgba(255,255,255,0.1)"},{offset:1,color:"rgba(155,  0,  0,0.0)"}]).toStyle()).fillRect(0,0,80,80).element));a===n&&(a=I(80,1,0.8,tm.graphics.Canvas().resize(80,80).setFillStyle(tm.graphics.RadialGradient(40,40,0,40,40,40).addColorStopList([{offset:0,color:"rgba(255,255,255,0.1)"},{offset:1,color:"rgba(  0,  0,155,0.0)"}]).toStyle()).fillRect(0,0,80,80).element));g=0===g?b.clone().addChildTo(this):a.clone().addChildTo(this);g.speed=0.6;var k=Math.randf(0,2*Math.PI),r=Math.rand(0,20);g.setPosition(Math.cos(k)*
r+c,Math.sin(k)*r+f);var t=this;g.update=function(){this.x+=Math.cos(k)*this.speed;this.y+=Math.sin(k)*this.speed;if(-50>this.x||530<this.x||-50>this.y||690<this.y){this.remove();var a=t.pb.indexOf(this);-1!==a&&t.pb.splice(a,1)}};this.pb.push(g)}},xc:function(a,b){var g={};g[0]=this.ee;g[1]=this.Ac;g[2]=this.yc;g[3]=this.zc;g[4]=this.de;g[5]=q();(g=g[a])&&g.call(this,b)},jd:function(){this.Da(0,"MAIN MENU",["start","tutorial","setting","save score"],this.ed,["\u30b2\u30fc\u30e0\u3092\u958b\u59cb\u3057\u307e\u3059",
"\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u3092\u958b\u59cb\u3057\u307e\u3059","\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u307e\u3059","\u30b2\u30fc\u30e0\u3092\u7d42\u4e86\u30579leap\u306b\u30b9\u30b3\u30a2\u3092\u767b\u9332\u3057\u307e\u3059"])},ee:function(a){4!==a&&(this.ed=a);switch(a){case 0:this.tweener.clear().call(function(){this.Mb=m;for(var a=0,b=this.pb.length;a<b;a++)this.pb[a].speed=6}.bind(this)).wait(1E3).call(function(){w.fa.Xd(1);this.pd(5,w.fa)}.bind(this));break;case 2:this.Na();
break;case 3:w.Pd()}},Na:function(){this.Da(1,"SETTING",["bgm volume","sound volume","difficulty"],this.Qb,["BGM\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u8a2d\u5b9a\u3057\u307e\u3059","\u52b9\u679c\u97f3\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u8a2d\u5b9a\u3057\u307e\u3059","\u96e3\u6613\u5ea6\u3092\u8a2d\u5b9a\u3057\u307e\u3059"])},Ac:function(a){3!==a&&(this.Qb=a);switch(a){case 0:this.Bc();break;case 1:this.Cc();break;case 2:this.he();break;default:this.jd()}},Bc:function(){this.Da(2,"BGM VOLUME","012345".split(""),
w.Db)},yc:function(a){6!==a&&(w.Db=a);this.Na()},Cc:function(){this.Da(3,"SE VOLUME","012345".split(""),w.fb)},zc:function(a){6!==a&&(w.fb=a);this.Na()},he:function(){this.Da(4,"DIFFICULTY",["easy","normal","hard","very hard","hell"],w.Uc,["\u521d\u5fc3\u8005\u3067\u3082\u5b89\u5fc3\u3057\u3066\u6311\u6226\u53ef\u80fd\u306a\u5165\u9580\u30b3\u30fc\u30b9","\u666e\u901a\u306e\u96e3\u6613\u5ea6\u3002easy\u3067\u306f\u7269\u8db3\u308a\u306a\u3044\u4eba\u3078","\u4e00\u822c\u7684\u306a\u5f3e\u5e55STG\u306e\u96e3\u6613\u5ea6",
"hard\u306f\u30cc\u30eb\u3059\u304e\u308b\u3068\u3044\u3046\u4eba\u5411\u3051","\u6b7b\u306c\u304c\u3088\u3044"])},de:function(a){5!==a&&(w.Uc=a);this.Na()},toString:function(){return"gls2.TitleScene"}})})();tm.createClass({superClass:X,init:function(){this.superInit();tm.app.Label("This is ShipSelectScene").setAlign("center").setBaseline("middle").setPosition(240,320).addChildTo(this)}});(function(){var b=n;B=tm.createClass({superClass:X,ca:n,score:0,od:n,ya:n,Fc:3,$c:n,ld:n,Xc:n,Vc:n,Wc:n,Pc:n,cd:n,oc:n,background:this.background=tm.graphics.LinearGradient(0,0,0,640).addColorStopList([{offset:0,color:"#030"},{offset:1,color:"#010"}]).toStyle(),init:function(){b!==n&&d(Error("class 'gls2.GameScene' is singleton!!"));this.superInit();b=this;this.zd();this.$c=tm.app.Object2D().addChildTo(this);this.Xc=tm.app.Object2D().addChildTo(this);this.Vc=tm.app.Object2D().addChildTo(this);this.ld=
tm.app.Object2D().addChildTo(this);this.Wc=tm.app.Object2D().addChildTo(this);this.Pc=tm.app.Object2D().addChildTo(this);this.cd=tm.app.Object2D().addChildTo(this);this.oc=R(200).setPosition(375,37).addChildTo(this.cd);tm.na.Pa.lb.Nc=this},Dc:function(a){this.oc.Hd(a)},zd:function(){var a=this.ya=tm.app.CanvasElement().addChildTo(this);a.rc=a.sc=0;a.direction=0.5*Math.PI;a.Gb=20;a.speed=1;a.ua=0;a.va=0;a.update=function(){this.ua=Math.cos(this.direction)*this.speed;this.va=Math.sin(this.direction)*
this.speed;this.rc=(this.rc+this.ua)%this.Gb;this.sc=(this.sc+this.va)%this.Gb};a.blendMode="lighter";a.draw=function(a){a.lineWidth=0.2;a.strokeStyle="#999";a.beginPath();for(var b=this.rc;480>b;b+=this.Gb)a.line(b,0,b,640);for(b=this.sc;640>b;b+=this.Gb)a.line(0,b,480,b);a.closePath();a.stroke()}},addChild:function(a){a instanceof D?this.ld.addChild(a):a instanceof K?a.aa.uc?this.$c.addChild(a):this.Xc.addChild(a):a instanceof H||a instanceof G||a instanceof E?this.Vc.addChild(a):a instanceof I||
a.$d?this.Wc.addChild(a):a instanceof M?this.Pc.addChild(a):this.superClass.prototype.addChild.apply(this,arguments)},update:function(a){this.od.update(a.frame);a.keyboard.getKeyDown("escape")?this.finish(0):a.keyboard.getKeyDown("space")?this.Rb(0):a.keyboard.getKeyDown("p")&&(a.canvas.saveAsImage(),this.Rb(0))},xc:function(a,b){switch(a){case 0:this.fe(b);break;case 1:this.Ac(b);break;case 2:this.ce(b);break;case 3:this.yc(b);break;case 4:this.zc(b)}},Rb:function(a){this.Da(0,"PAUSE",["resume",
"setting","exit game"],a,["\u30b2\u30fc\u30e0\u3092\u518d\u958b\u3057\u307e\u3059","\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u307e\u3059","\u30b2\u30fc\u30e0\u3092\u4e2d\u65ad\u3057\u3001\u30bf\u30a4\u30c8\u30eb\u753b\u9762\u306b\u623b\u308a\u307e\u3059"],p)},fe:function(a){switch(a){case 1:this.Na();break;case 2:this.ge()}},Na:function(){this.Da(1,"SETTING",["bgm volume","sound volume"],this.Qb,["BGM\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u8a2d\u5b9a\u3057\u307e\u3059","\u52b9\u679c\u97f3\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u8a2d\u5b9a\u3057\u307e\u3059"])},
Ac:function(a){3!==a&&(this.Qb=a);switch(a){case 0:this.Bc();break;case 1:this.Cc();break;default:this.Rb()}},ge:function(){this.Da(2,"REARY?",["yes","no"],1,["\u30b2\u30fc\u30e0\u3092\u4e2d\u65ad\u3057\u3001\u30bf\u30a4\u30c8\u30eb\u753b\u9762\u306b\u623b\u308a\u307e\u3059","\u524d\u306e\u753b\u9762\u3078\u623b\u308a\u307e\u3059"],p)},ce:function(a){0===a?this.finish(0):this.Rb(1)},Bc:function(){this.Da(3,"BGM VOLUME","012345".split(""),w.Db)},yc:function(a){6!==a&&(w.Db=a);this.Na(1)},Cc:function(){this.Da(4,
"SE VOLUME","012345".split(""),w.fb)},zc:function(a){6!==a&&(w.fb=a);this.Na(1)},draw:function(a){a.clearColor(this.background,0,0)},Xd:function(){this.oc.Id().clear();this.ca!==n&&this.ca.remove();K.jb();G.jb();A.jb();this.ca=D(this);this.ie(0)},ie:function(a){this.od=U.create(this,a);this.wc()},wc:function(){this.ca.setPosition(240,672).setFrameIndex(3).addChildTo(this);this.ca.Sa=p;this.ca.hd=m;this.ca.tweener.clear().wait(30).moveBy(0,-120).wait(120).call(function(){this.Sa=m}.bind(this.ca)).wait(120).call(function(){this.hd=
p}.bind(this.ca))},Ge:function(){this.ca.remove();this.Fc-=1;0<this.Fc&&this.wc()},Be:function(){this.wc()},ve:q(),Ce:q(),Ae:q()})})();tm.createClass({superClass:X,init:function(){this.superInit()},update:function(b){this.superClass.prototype.update.apply(this,arguments)}});tm.createClass({superClass:X,init:function(){this.superInit()},update:function(b){this.superClass.prototype.update.apply(this,arguments)}});tm.createClass({superClass:X,init:function(){this.superInit()},update:function(b){this.superClass.prototype.update.apply(this,arguments)}});tm.createClass({superClass:X,init:function(){this.superInit()},update:function(b){this.superClass.prototype.update.apply(this,arguments)}});(function(){K=tm.createClass({superClass:tm.app.CanvasElement,frame:0,direction:0,speed:0,ca:n,fa:n,aa:n,ba:n,Ma:0,init:function(a,c,f){this.superInit();this.frame=0;this.fa=a;this.ca=this.fa.ca;this.aa=N[c](this);this.ba=O[f](this);this.ba.Aa(this);this.aa.Aa(this);this.aa.uc||Q(this);this.addEventListener("completeattack",function(){this.Ua()});this.addEventListener("added",function(){b.push(this)});this.addEventListener("removed",function(){var a=b.indexOf(this);-1!==a&&b.splice(a,1)})},Va:function(){this.ba.Va();
this.aa.Va()},Ua:function(){this.ba.Ua();this.aa.Ua()},update:function(a){this.ba.update();this.aa.update();this.aa.uc&&(this.x+=a.fa.ya.ua,this.y+=a.fa.ya.va);this.frame+=1},Rc:function(a){if(this.x<this.radius||480-this.radius<this.x||this.y<this.radius||640-this.radius<this.y)return p;this.Ma-=a;return 0>=this.Ma?(this.aa.Nd(),a=Math.random(),0.3>a?this.fa.Dc("enemy destroy."):0.6>a?this.fa.Dc(this.aa.name+" destroy."):this.fa.Dc("ETR reaction gone."),this.remove(),m):p},draw:function(a){this.aa.draw(a)}});
K.jb=function(){for(var a=[].concat(b),c=0,f=a.length;c<f;c++)a[c].remove()};var b=K.fc=[]})();var N=tm.createClass({$:n,uc:p,Ka:n,Ma:10,name:"enemy",init:function(b){this.$=b},Aa:function(){this.$.Ma=this.Ma},Va:q(),Ua:q(),update:q(),draw:q(),Nd:function(){P.Qd(this.$.x,this.$.y,this.$.fa)}});
N.Aa=function(){var b=tm.createClass({superClass:tm.app.Sprite,init:function(a,b,f){this.superInit(a,b,f)},draw:function(a){var b=this.srcRect;a.context.drawImage(this._image.element,b.x,b.y,b.width,b.height,-this.width*this.origin.x,-this.height*this.origin.y,this.width,this.height)}});this.heri1=tm.createClass({superClass:N,name:"kujo",Ma:3,init:function(a){this.superInit(a);this.Ka=b("tex1",64,64)},update:function(){this.$.scaleX=this.$.x<this.$.ca.x?-1:1},draw:function(a){2>this.$.frame%4?this.Ka.srcRect.set(448,
0,64,64):this.Ka.srcRect.set(0,64,64,64);this.Ka.draw(a)}});this.heri2=tm.createClass({superClass:N,name:"kiryu",Ma:10,init:function(a){this.superInit(a);this.Ka=b("tex1",64,64)},update:function(){this.$.scaleX=this.$.x<this.$.ca.x?-1:1},draw:function(a){2>this.$.frame%4?this.Ka.srcRect.set(64,64,64,64):this.Ka.srcRect.set(128,64,64,64);this.Ka.draw(a)}})};var O=tm.createClass({$:n,ca:n,init:function(b){this.$=b;this.ca=b.fa.ca},Aa:q(),Va:q(),Ua:q(),update:q()});
O.Aa=function(){function b(a,b){var f=A[b].Hb();a.addEventListener("enterframe",f);a.addEventListener("completeattack",function(){this.removeEventListener("enterframe",f)})}this.heri1a=tm.createClass({superClass:O,init:function(a){this.superInit(a)},Va:function(){var a=Math.randf(64,192);this.$.tweener.clear().wait(Math.rand(10,500)).move(this.$.x,a,7*a,"easeOutQuad").call(function(){b(this.$,"basic0-0")}.bind(this))},Ua:function(){this.$.tweener.clear().wait(1E3).moveBy(0,-640,2E3,"easeInQuad").call(function(){this.$.remove()}.bind(this))}});
this.heri1b=tm.createClass({superClass:O,init:function(a){this.superInit(a)},Va:function(){var a=Math.randf(192,320);this.$.tweener.clear().wait(Math.rand(10,500)).move(this.$.x,a,7*a,"easeOutQuad").call(function(){b(this.$,"basic0-0")}.bind(this))},Ua:function(){this.$.tweener.clear().wait(1E3).moveBy(0,-640,2E3,"easeInQuad").call(function(){this.$.remove()}.bind(this))}});this.heri2=tm.createClass({superClass:O,init:function(a){this.superInit(a);this.angle=0.5*Math.PI;this.enter=p;this.Ec=Math.rand(0,
60);this.speed=0},update:function(){var a=this.$.frame;a===this.Ec?this.speed=8:a===this.Ec+10?b(this.$,"basic1-0"):this.Ec<a&&this.$.y<this.ca.y&&(this.angle+=Math.atan2(this.ca.y-this.$.y,this.ca.x-this.$.x)<this.angle?-0.02:0.02,this.angle=Math.clamp(this.angle,0.5,Math.PI-0.5));this.$.x+=Math.cos(this.angle)*this.speed;this.$.y+=Math.sin(this.angle)*this.speed;a=this.$.radius;this.$.x<-a||480+a<this.$.x||this.$.y<-a||640+a<this.$.y?this.enter&&this.$.remove():this.enter=m;if(this.ca.y<this.$.y||
9E4>this.$.position.distanceSquared(this.ca.position)){var a=this.$,c=[].concat(a._listeners.enterframe);if(c)for(var f=0,g=c.length;f<g;f++)c[f]&&c[f].tc&&a.removeEventListener("enterframe",c[f])}}})};L={"heri1-left":[{aa:"heri2",ba:"heri1a",x:48,y:-100},{aa:"heri2",ba:"heri1b",x:96,y:-100},{aa:"heri2",ba:"heri1a",x:144,y:-100},{aa:"heri2",ba:"heri1b",x:192,y:-100},{aa:"heri2",ba:"heri1a",x:240,y:-100}],"heri1-center":[{aa:"heri2",ba:"heri1a",x:144,y:-100},{aa:"heri2",ba:"heri1b",x:192,y:-100},{aa:"heri2",ba:"heri1a",x:240,y:-100},{aa:"heri2",ba:"heri1b",x:288,y:-100},{aa:"heri2",ba:"heri1a",x:336,y:-100}],"heri1-right":[{aa:"heri2",ba:"heri1a",x:240,y:-100},{aa:"heri2",ba:"heri1b",x:288,y:-100},
{aa:"heri2",ba:"heri1a",x:336,y:-100},{aa:"heri2",ba:"heri1b",x:384,y:-100},{aa:"heri2",ba:"heri1a",x:432,y:-100}],"heri2-left":[{aa:"heri1",ba:"heri2",x:48,y:-100},{aa:"heri1",ba:"heri2",x:96,y:-100},{aa:"heri1",ba:"heri2",x:144,y:-100},{aa:"heri1",ba:"heri2",x:192,y:-100},{aa:"heri1",ba:"heri2",x:240,y:-100}],"heri2-center":[{aa:"heri1",ba:"heri2",x:144,y:-100},{aa:"heri1",ba:"heri2",x:192,y:-100},{aa:"heri1",ba:"heri2",x:240,y:-100},{aa:"heri1",ba:"heri2",x:288,y:-100},{aa:"heri1",ba:"heri2",x:336,
y:-100}],"heri2-right":[{aa:"heri1",ba:"heri2",x:240,y:-100},{aa:"heri1",ba:"heri2",x:288,y:-100},{aa:"heri1",ba:"heri2",x:336,y:-100},{aa:"heri1",ba:"heri2",x:384,y:-100},{aa:"heri1",ba:"heri2",x:432,y:-100}]};(function(){var b=[],a=[];M=tm.createClass({superClass:tm.app.Sprite,init:function(){this.superInit("tex0",20,20)}});A={Aa:function(){for(var c=0;255>c;c++){var f=M();f.addEventListener("removed",function(){this.clearEventListener("enterframe");b.push(this);var c=a.indexOf(this);-1!==c&&a.splice(c,1)});b.push(f)}c=tm.na.Pa.lb;c.vc=function(a){return!(-50>a.x||530<a.x||-50>a.y||690<a.y)};c.Oc=function(){var c=b.shift(0);if(c)return a.push(c),c.setFrameIndex(1),c.scaleX=1.2,c.scaleY=1.5,c.addEventListener("enterframe",
function(){this.rotation+=15}),c;console.warn("\u5f3e\u304c\u8db3\u308a\u306a\u3044\uff01")};c.Xa=4},jb:function(){for(var b=[].concat(a),c=0,f=b.length;c<f;c++)b[c].remove()}};var c=u.ea,f=c.Kb(c.direction(0),c.ha());A["basic0-0"]=new u.sa({top:c.action([f])});A["basic0-4"]=new u.sa({top:c.action([c.repeat(3,[c.repeat(5,[c.Kb(c.direction(-20),c.speed("$loop.count*0.06+0.75"),c.ha()),c.Kb(c.direction(0),c.speed("$loop.count*0.06+0.75"),c.ha()),c.Kb(c.direction(20),c.speed("$loop.count*0.06+0.75"),
c.ha())]),c.wait(40)])])});A["basic1-0"]=new u.sa({top:c.action([c.repeat(999,[f,c.wait(20)])])})})();
